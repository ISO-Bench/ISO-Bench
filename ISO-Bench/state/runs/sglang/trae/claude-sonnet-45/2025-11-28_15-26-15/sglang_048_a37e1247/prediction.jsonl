{"instance_id": "/home/ubuntu/OmniPerf-Bench/sglan__repo-136c6e0", "model_patch": "diff --git a/python/pyproject.toml b/python/pyproject.toml\nindex e72488849..0d6d712a6 100644\n--- a/python/pyproject.toml\n+++ b/python/pyproject.toml\n@@ -38,6 +38,7 @@ runtime_common = [\n     \"psutil\",\n     \"pydantic\",\n     \"pynvml\",\n+    \"pybase64\",\n     \"python-multipart\",\n     \"pyzmq>=25.1.2\",\n     \"soundfile==0.13.1\",\ndiff --git a/python/sglang/bench_serving.py b/python/sglang/bench_serving.py\nindex 04c2202d2..3ba4eae0f 100644\n--- a/python/sglang/bench_serving.py\n+++ b/python/sglang/bench_serving.py\n@@ -814,9 +814,9 @@ def sample_mmmu_requests(\n         List of tuples (prompt, prompt_token_len, output_token_len).\n     \"\"\"\n     try:\n-        import base64\n         import io\n \n+        import pybase64\n         from datasets import load_dataset\n     except ImportError:\n         raise ImportError(\"Please install datasets: pip install datasets\")\n@@ -867,7 +867,7 @@ def sample_mmmu_requests(\n                     # Encode image to base64\n                     buffered = io.BytesIO()\n                     image.save(buffered, format=\"JPEG\")\n-                    img_str = base64.b64encode(buffered.getvalue()).decode(\"utf-8\")\n+                    img_str = pybase64.b64encode(buffered.getvalue()).decode(\"utf-8\")\n                     image_data = f\"data:image/jpeg;base64,{img_str}\"\n                 else:\n                     continue\ndiff --git a/python/sglang/srt/entrypoints/http_server_engine.py b/python/sglang/srt/entrypoints/http_server_engine.py\nindex b2edf1abe..d1db80d65 100644\n--- a/python/sglang/srt/entrypoints/http_server_engine.py\n+++ b/python/sglang/srt/entrypoints/http_server_engine.py\n@@ -1,4 +1,3 @@\n-import base64\n import copy\n import dataclasses\n import multiprocessing\n@@ -7,6 +6,7 @@ import threading\n import time\n from typing import Any, Dict, List, Optional, Tuple, Union\n \n+import pybase64\n import requests\n import torch\n import torch.distributed as dist\ndiff --git a/python/sglang/srt/multimodal/mm_utils.py b/python/sglang/srt/multimodal/mm_utils.py\nindex 9c05c1859..c399be806 100644\n--- a/python/sglang/srt/multimodal/mm_utils.py\n+++ b/python/sglang/srt/multimodal/mm_utils.py\n@@ -28,12 +28,12 @@ LLaVA-Onevision : https://arxiv.org/pdf/2408.03326\n \n \"\"\"\n import ast\n-import base64\n import math\n import re\n from io import BytesIO\n \n import numpy as np\n+import pybase64\n from PIL import Image\n \n from sglang.srt.utils import flatten_nested_list\n@@ -252,7 +252,7 @@ def process_anyres_image(image, processor, grid_pinpoints):\n \n \n def load_image_from_base64(image):\n-    return Image.open(BytesIO(base64.b64decode(image)))\n+    return Image.open(BytesIO(pybase64.b64decode(image, validate=True)))\n \n \n def expand2square(pil_img, background_color):\ndiff --git a/python/sglang/srt/utils.py b/python/sglang/srt/utils.py\nindex 052e7328f..bc2affa1a 100644\n--- a/python/sglang/srt/utils.py\n+++ b/python/sglang/srt/utils.py\n@@ -15,7 +15,6 @@\n \n from __future__ import annotations\n \n-import base64\n import builtins\n import ctypes\n import dataclasses\n@@ -68,6 +67,7 @@ from typing import (\n \n import numpy as np\n import psutil\n+import pybase64\n import requests\n import torch\n import torch.distributed\n@@ -616,7 +616,7 @@ def decode_video_base64(video_base64):\n     from PIL import Image\n \n     # Decode the base64 string\n-    video_bytes = base64.b64decode(video_base64)\n+    video_bytes = pybase64.b64decode(video_base64, validate=True)\n \n     # Placeholder for the start indices of each PNG image\n     img_starts = []\n@@ -702,7 +702,9 @@ def load_audio(audio_file: str, sr: int = 16000, mono: bool = True) -> np.ndarra\n         audio, original_sr = sf.read(BytesIO(audio_file))\n     elif audio_file.startswith(\"data:\"):\n         audio_file = audio_file.split(\",\")[1]\n-        audio, original_sr = sf.read(BytesIO(base64.b64decode(audio_file)))\n+        audio, original_sr = sf.read(\n+            BytesIO(pybase64.b64decode(audio_file, validate=True))\n+        )\n     elif audio_file.startswith(\"http://\") or audio_file.startswith(\"https://\"):\n         timeout = int(os.getenv(\"REQUEST_TIMEOUT\", \"5\"))\n         response = requests.get(audio_file, stream=True, timeout=timeout)\n@@ -771,12 +773,12 @@ def load_image(\n         image = Image.open(image_file)\n     elif image_file.startswith(\"data:\"):\n         image_file = image_file.split(\",\")[1]\n-        image = Image.open(BytesIO(base64.b64decode(image_file)))\n+        image = Image.open(BytesIO(pybase64.b64decode(image_file, validate=True)))\n     elif image_file.startswith(\"video:\"):\n         image_file = image_file.replace(\"video:\", \"\")\n         image, image_size = decode_video_base64(image_file)\n     elif isinstance(image_file, str):\n-        image = Image.open(BytesIO(base64.b64decode(image_file)))\n+        image = Image.open(BytesIO(pybase64.b64decode(image_file, validate=True)))\n     else:\n         raise ValueError(f\"Invalid image: {image}\")\n \n@@ -1866,7 +1868,7 @@ class MultiprocessingSerializer:\n \n         if output_str:\n             # Convert bytes to base64-encoded string\n-            output = base64.b64encode(output).decode(\"utf-8\")\n+            output = pybase64.b64encode(output).decode(\"utf-8\")\n \n         return output\n \n@@ -1883,7 +1885,7 @@ class MultiprocessingSerializer:\n         \"\"\"\n         if isinstance(data, str):\n             # Decode base64 string to bytes\n-            data = base64.b64decode(data)\n+            data = pybase64.b64decode(data, validate=True)\n \n         return ForkingPickler.loads(data)\n \ndiff --git a/python/sglang/utils.py b/python/sglang/utils.py\nindex 6b3f36e19..83c653232 100644\n--- a/python/sglang/utils.py\n+++ b/python/sglang/utils.py\n@@ -1,6 +1,5 @@\n \"\"\"Common utilities\"\"\"\n \n-import base64\n import importlib\n import json\n import logging\n@@ -20,6 +19,7 @@ from json import dumps\n from typing import Any, Callable, List, Optional, Tuple, Type, Union\n \n import numpy as np\n+import pybase64\n import requests\n from IPython.display import HTML, display\n from pydantic import BaseModel\n@@ -148,15 +148,15 @@ def encode_image_base64(image_path: Union[str, bytes]):\n     if isinstance(image_path, str):\n         with open(image_path, \"rb\") as image_file:\n             data = image_file.read()\n-            return base64.b64encode(data).decode(\"utf-8\")\n+            return pybase64.b64encode(data).decode(\"utf-8\")\n     elif isinstance(image_path, bytes):\n-        return base64.b64encode(image_path).decode(\"utf-8\")\n+        return pybase64.b64encode(image_path).decode(\"utf-8\")\n     else:\n         # image_path is PIL.WebPImagePlugin.WebPImageFile\n         image = image_path\n         buffered = BytesIO()\n         image.save(buffered, format=\"PNG\")\n-        return base64.b64encode(buffered.getvalue()).decode(\"utf-8\")\n+        return pybase64.b64encode(buffered.getvalue()).decode(\"utf-8\")\n \n \n def encode_frame(frame):\n@@ -223,7 +223,7 @@ def encode_video_base64(video_path: str, num_frames: int = 16):\n     video_bytes = b\"\".join(encoded_frames)\n \n     # Encode the concatenated bytes to base64\n-    video_base64 = \"video:\" + base64.b64encode(video_bytes).decode(\"utf-8\")\n+    video_base64 = \"video:\" + pybase64.b64encode(video_bytes).decode(\"utf-8\")\n \n     return video_base64\n \ndiff --git a/test/srt/test_vision_openai_server_common.py b/test/srt/test_vision_openai_server_common.py\nindex 3687d9381..42b8e889d 100644\n--- a/test/srt/test_vision_openai_server_common.py\n+++ b/test/srt/test_vision_openai_server_common.py\n@@ -1,5 +1,4 @@\n import base64\n-import copy\n import io\n import json\n import os\n", "model_name_or_path": "gpt-5-2025-08-07"}
