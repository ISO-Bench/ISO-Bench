{"instance_id": "/home/ubuntu/OmniPerf-Bench/sglan__repo-e822e59", "model_patch": "diff --git a/python/sglang/lang/interpreter.py b/python/sglang/lang/interpreter.py\nindex 00691ca50..8c5c9c5e3 100644\n--- a/python/sglang/lang/interpreter.py\n+++ b/python/sglang/lang/interpreter.py\n@@ -256,9 +256,15 @@ class StreamExecutor:\n         ret = self.meta_info.get(name, None)\n         return ret\n \n-    def fork(self, number: int, position_ids_offset: Optional[List[int]] = None):\n-        self.submit(SglCommitLazy())\n-        self.sync()\n+    def fork(\n+        self,\n+        number: int,\n+        position_ids_offset: Optional[List[int]] = None,\n+        copy: bool = False,\n+    ):\n+        if int(number) > 1 or copy:\n+            self.submit(SglCommitLazy())\n+            self.sync()\n \n         number = int(number)\n \n@@ -269,6 +275,7 @@ class StreamExecutor:\n                 self.default_sampling_para,\n                 self.chat_template,\n                 self.stream,\n+                use_thread=self.use_thread,\n             )\n             for _ in range(number)\n         ]\n@@ -641,15 +648,15 @@ class ProgramState:\n         yield\n         self.stream_executor.submit(SglVarScopeEnd(name))\n \n-    def fork(self, number: int = 1, position_ids_offset: Optional[List[int]] = None):\n-        stream_executors = self.stream_executor.fork(number, position_ids_offset)\n+    def fork(self, number: int = 1, position_ids_offset: Optional[List[int]] = None, copy: bool = False):\n+        stream_executors = self.stream_executor.fork(number, position_ids_offset, copy)\n         states = [ProgramState(x) for x in stream_executors]\n         state_group = ProgramStateGroup(states, self)\n         return state_group\n \n     @contextmanager\n     def copy(self, position_ids_offset: Optional[List[int]] = None):\n-        state_group = self.fork(1, position_ids_offset)\n+        state_group = self.fork(1, position_ids_offset, copy=True)\n         try:\n             yield state_group[0]\n         finally:\ndiff --git a/python/sglang/srt/managers/router/radix_cache.py b/python/sglang/srt/managers/router/radix_cache.py\nindex 7bb8a4b2a..3f6bbf4b7 100644\n--- a/python/sglang/srt/managers/router/radix_cache.py\n+++ b/python/sglang/srt/managers/router/radix_cache.py\n@@ -120,7 +120,7 @@ class RadixCache:\n         if len(key) == 0:\n             return\n \n-        if key[0] in node.children.keys():\n+        if key[0] in node.children:\n             child = node.children[key[0]]\n             prefix_len = match(child.key, key)\n             if prefix_len < len(child.key):\n@@ -151,7 +151,7 @@ class RadixCache:\n         if len(key) == 0:\n             return 0\n \n-        if key[0] in node.children.keys():\n+        if key[0] in node.children:\n             child = node.children[key[0]]\n             prefix_len = match(child.key, key)\n \n@@ -183,9 +183,7 @@ class RadixCache:\n             self._print_helper(child, indent=indent + 2)\n \n     def _delete_leaf(self, node):\n-        for k, v in node.parent.children.items():\n-            if v == node:\n-                break\n+        k = node.key[0]\n         del node.parent.children[k]\n         self.evictable_size_ -= len(node.key)\n \n", "model_name_or_path": "gpt-5-2025-08-07"}
