{"instance_id": "/home/ubuntu/OmniPerf-Bench/sglan__repo-8c7279c", "model_patch": "diff --git a/model_patch.diff b/model_patch.diff\nnew file mode 100644\nindex 000000000..e69de29bb\ndiff --git a/python/sglang/srt/two_batch_overlap.py b/python/sglang/srt/two_batch_overlap.py\nindex 0fbc3c8e7..2560de245 100644\n--- a/python/sglang/srt/two_batch_overlap.py\n+++ b/python/sglang/srt/two_batch_overlap.py\n@@ -40,13 +40,21 @@ def compute_split_seq_index(\n \n def _split_array_by_half_sum(arr: Sequence[int]) -> int:\n     overall_sum = sum(arr)\n-    accumulator, split_index = 0, 0\n-    for value in arr[:-1]:\n-        accumulator += value\n-        split_index += 1\n-        if accumulator >= overall_sum // 2:\n+    left_sum = 0\n+    min_diff = float(\"inf\")\n+    best_index = 0\n+\n+    for i in range(1, len(arr)):\n+        left_sum += arr[i - 1]\n+        right_sum = overall_sum - left_sum\n+        diff = abs(left_sum - right_sum)\n+        if diff <= min_diff:\n+            min_diff = diff\n+            best_index = i\n+        else:\n             break\n-    return split_index\n+\n+    return best_index\n \n \n def compute_split_token_index(\n@@ -139,17 +147,15 @@ class TboDPAttentionPreparer:\n \n     @staticmethod\n     def _compute_global_forward_mode(forward_modes):\n-        converted_forward_modes = [\n-            ForwardMode.DECODE.value if x == ForwardMode.IDLE.value else x\n-            for x in forward_modes\n-        ]\n-        forward_mode_agree = TboDPAttentionPreparer._is_all_same(\n-            converted_forward_modes\n-        )\n-        global_forward_mode = (\n-            ForwardMode(converted_forward_modes[0]) if forward_mode_agree else None\n-        )\n-        return global_forward_mode, forward_mode_agree\n+        def _convert(x):\n+            return ForwardMode.DECODE.value if x == ForwardMode.IDLE.value else x\n+\n+        it = iter(forward_modes)\n+        first = _convert(next(it))\n+        for x in it:\n+            if _convert(x) != first:\n+                return None, False\n+        return ForwardMode(first), True\n \n     @staticmethod\n     def _is_all_same(x):\n@@ -268,7 +274,7 @@ class TboForwardBatchPreparer:\n         # TODO improve, e.g. unify w/ `init_raw`\n         if global_server_args_dict[\"moe_dense_tp_size\"] == 1:\n             sum_len = end_token_index - start_token_index\n-            gathered_buffer = torch.zeros(\n+            gathered_buffer = torch.empty(\n                 (sum_len, batch.gathered_buffer.shape[1]),\n                 dtype=batch.gathered_buffer.dtype,\n                 device=batch.gathered_buffer.device,\n", "model_name_or_path": "gpt-5-2025-08-07"}
