{"instance_id": "/home/ubuntu/OmniPerf-Bench/sglan__repo-62cac2c", "model_patch": "diff --git a/python/sglang/srt/disaggregation/mooncake/conn.py b/python/sglang/srt/disaggregation/mooncake/conn.py\nindex 4c3faee..337b27a 100644\n--- a/python/sglang/srt/disaggregation/mooncake/conn.py\n+++ b/python/sglang/srt/disaggregation/mooncake/conn.py\n@@ -243,15 +243,12 @@ class MooncakeKVManager(BaseKVManager):\n             prefill_kv_indices, dst_kv_indices\n         )\n \n-        num_layers = len(self.kv_args.kv_data_ptrs)\n-        layers_params = [\n-            (\n-                self.kv_args.kv_data_ptrs[layer_id],\n-                dst_kv_ptrs[layer_id],\n-                self.kv_args.kv_item_lens[layer_id],\n-            )\n-            for layer_id in range(num_layers)\n-        ]\n+        # Optimize by using zip instead of range-based list comprehension\n+        layers_params = list(zip(\n+            self.kv_args.kv_data_ptrs,\n+            dst_kv_ptrs,\n+            self.kv_args.kv_item_lens\n+        ))\n \n         # Worker function for processing a single layer\n         def process_layer(src_ptr: int, dst_ptr: int, item_len: int) -> int:\n@@ -306,9 +303,11 @@ class MooncakeKVManager(BaseKVManager):\n     def sync_status_to_decode_endpoint(\n         self, remote: str, dst_port: int, room: int, status: int\n     ):\n+        # Optimize string operations: use rpartition and f-string for faster concatenation\n         if \":\" in remote:\n-            remote = remote.split(\":\")[0]\n-        self._connect(\"tcp://\" + remote + \":\" + str(dst_port)).send_multipart(\n+            remote = remote.rpartition(\":\")[0]\n+        endpoint = f\"tcp://{remote}:{dst_port}\"\n+        self._connect(endpoint).send_multipart(\n             [\n                 str(room).encode(\"ascii\"),\n                 str(status).encode(\"ascii\"),\n@@ -564,7 +563,8 @@ class MooncakeKVManager(BaseKVManager):\n         # requests with the same dst_sessions will be added into the same\n         # queue, which enables early abort with failed sessions.\n         dst_infos = self.transfer_infos[bootstrap_room].keys()\n-        session_port_sum = sum(int(session.split(\":\")[1]) for session in dst_infos)\n+        # Optimize string operations by using str.rpartition which is faster than split\n+        session_port_sum = sum(int(session.rpartition(\":\")[2]) for session in dst_infos)\n         shard_idx = session_port_sum % len(self.transfer_queues)\n \n         self.transfer_queues[shard_idx].put(\n@@ -750,6 +750,9 @@ class MooncakeKVReceiver(BaseKVReceiver):\n     _socket_cache = {}\n     _socket_locks = {}\n     _global_lock = threading.Lock()\n+    # Pre-encode frequently used strings to optimize performance\n+    _NONE_BYTES = b\"None\"\n+    _EMPTY_BYTES = b\"\"\n \n     def __init__(\n         self,\n@@ -923,18 +926,17 @@ class MooncakeKVReceiver(BaseKVReceiver):\n             self.prefill_server_url = (\n                 f\"{bootstrap_info['rank_ip']}:{bootstrap_info['rank_port']}\"\n             )\n-            packed_kv_data_ptrs = b\"\".join(\n-                struct.pack(\"Q\", ptr) for ptr in self.kv_mgr.kv_args.kv_data_ptrs\n-            )\n-            packed_aux_data_ptrs = b\"\".join(\n-                struct.pack(\"Q\", ptr) for ptr in self.kv_mgr.kv_args.aux_data_ptrs\n-            )\n+            # Optimize struct packing by using single pack call with format string\n+            kv_ptrs = self.kv_mgr.kv_args.kv_data_ptrs\n+            aux_ptrs = self.kv_mgr.kv_args.aux_data_ptrs\n+            packed_kv_data_ptrs = struct.pack(f\"{len(kv_ptrs)}Q\", *kv_ptrs)\n+            packed_aux_data_ptrs = struct.pack(f\"{len(aux_ptrs)}Q\", *aux_ptrs)\n \n             sock, lock = self._connect(\"tcp://\" + self.prefill_server_url)\n             with lock:\n                 sock.send_multipart(\n                     [\n-                        \"None\".encode(\"ascii\"),\n+                        self._NONE_BYTES,\n                         get_local_ip_by_remote().encode(\"ascii\"),\n                         str(self.kv_mgr.rank_port).encode(\"ascii\"),\n                         self.session_id.encode(\"ascii\"),\n@@ -968,8 +970,8 @@ class MooncakeKVReceiver(BaseKVReceiver):\n                         get_local_ip_by_remote().encode(\"ascii\"),\n                         str(self.kv_mgr.rank_port).encode(\"ascii\"),\n                         self.session_id.encode(\"ascii\"),\n-                        kv_indices.tobytes() if not is_dummy else b\"\",\n-                        str(aux_index).encode(\"ascii\") if not is_dummy else b\"\",\n+                        kv_indices.tobytes() if not is_dummy else self._EMPTY_BYTES,\n+                        str(aux_index).encode(\"ascii\") if not is_dummy else self._EMPTY_BYTES,\n                         str(self.required_dst_info_num).encode(\"ascii\"),\n                     ]\n                 )\n", "model_name_or_path": "gpt-5-2025-08-07"}
