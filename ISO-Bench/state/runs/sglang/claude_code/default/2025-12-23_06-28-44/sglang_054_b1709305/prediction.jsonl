{"instance_id": "/home/ubuntu/OmniPerf-Bench/sglan__repo-5ab20cc", "model_patch": "diff --git a/python/sglang/srt/mem_cache/radix_cache.py b/python/sglang/srt/mem_cache/radix_cache.py\nindex 68bcb5b..1171952 100644\n--- a/python/sglang/srt/mem_cache/radix_cache.py\n+++ b/python/sglang/srt/mem_cache/radix_cache.py\n@@ -21,7 +21,7 @@ The radix tree data structure for managing the KV cache.\n \n import heapq\n import time\n-from collections import defaultdict\n+from collections import defaultdict, deque\n from typing import TYPE_CHECKING, Callable, List, Optional\n \n import torch\n@@ -34,6 +34,8 @@ if TYPE_CHECKING:\n \n \n class TreeNode:\n+    __slots__ = ('children', 'parent', 'key', 'value', 'lock_ref', 'last_access_time')\n+\n     def __init__(self):\n         self.children = defaultdict(TreeNode)\n         self.parent = None\n@@ -47,12 +49,10 @@ class TreeNode:\n \n \n def _key_match(key0: List, key1: List):\n-    i = 0\n-    for k0, k1 in zip(key0, key1):\n+    for i, (k0, k1) in enumerate(zip(key0, key1)):\n         if k0 != k1:\n-            break\n-        i += 1\n-    return i\n+            return i\n+    return min(len(key0), len(key1))\n \n \n class RadixCache(BasePrefixCache):\n@@ -84,9 +84,9 @@ class RadixCache(BasePrefixCache):\n         last_node = [self.root_node]\n         self._match_prefix_helper(self.root_node, key, value, last_node)\n         if value:\n-            value = torch.concat(value)\n+            value = torch.cat(value)\n         else:\n-            value = torch.tensor([], dtype=torch.int32)\n+            value = torch.empty(0, dtype=torch.int32)\n         return value, last_node[0]\n \n     def insert(self, key: List, value=None):\n@@ -177,10 +177,11 @@ class RadixCache(BasePrefixCache):\n         heapq.heapify(leaves)\n \n         num_evicted = 0\n-        while num_evicted < num_tokens and len(leaves):\n+        root_node = self.root_node\n+        while num_evicted < num_tokens and leaves:\n             x = heapq.heappop(leaves)\n \n-            if x == self.root_node:\n+            if x is root_node:\n                 break\n             if x.lock_ref > 0:\n                 continue\n@@ -189,7 +190,7 @@ class RadixCache(BasePrefixCache):\n             num_evicted += len(x.value)\n             self._delete_leaf(x)\n \n-            if len(x.parent.children) == 0:\n+            if not x.parent.children:\n                 heapq.heappush(leaves, x.parent)\n \n     def inc_lock_ref(self, node: TreeNode):\n@@ -226,12 +227,14 @@ class RadixCache(BasePrefixCache):\n     def _match_prefix_helper(\n         self, node: TreeNode, key: List, value, last_node: TreeNode\n     ):\n-        node.last_access_time = time.time()\n+        current_time = time.time()\n+        node.last_access_time = current_time\n         if len(key) == 0:\n             return\n \n-        if key[0] in node.children.keys():\n+        if key[0] in node.children:\n             child = node.children[key[0]]\n+            child.last_access_time = current_time\n             prefix_len = _key_match(child.key, key)\n             if prefix_len < len(child.key):\n                 new_node = self._split_node(child.key, child, prefix_len)\n@@ -257,12 +260,14 @@ class RadixCache(BasePrefixCache):\n         return new_node\n \n     def _insert_helper(self, node: TreeNode, key: List, value):\n-        node.last_access_time = time.time()\n+        current_time = time.time()\n+        node.last_access_time = current_time\n         if len(key) == 0:\n             return 0\n \n-        if key[0] in node.children.keys():\n+        if key[0] in node.children:\n             child = node.children[key[0]]\n+            child.last_access_time = current_time\n             prefix_len = _key_match(child.key, key)\n \n             if prefix_len == len(child.key):\n@@ -283,6 +288,7 @@ class RadixCache(BasePrefixCache):\n             new_node.parent = node\n             new_node.key = key\n             new_node.value = value\n+            new_node.last_access_time = current_time\n             node.children[key[0]] = new_node\n             self.evictable_size_ += len(value)\n         return 0\n@@ -307,7 +313,7 @@ class RadixCache(BasePrefixCache):\n \n     def _collect_leaves(self):\n         ret_list = []\n-        stack = [self.root_node]\n+        stack = deque([self.root_node])\n \n         while stack:\n             cur_node = stack.pop()\n", "model_name_or_path": "gpt-5-2025-08-07"}
