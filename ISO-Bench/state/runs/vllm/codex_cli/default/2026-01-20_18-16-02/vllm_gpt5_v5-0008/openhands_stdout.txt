Plan update: I created a quick benchmark, made targeted optimizations, and regenerated a diff. Next, I can extend profiling if you want deeper gains.
