{"instance_id": "vllm-project__vllm-5fc5ce0", "model_patch": "diff --git a/CMakeLists.txt b/CMakeLists.txt\nindex 45a3b484e..f5ed8c549 100644\n--- a/CMakeLists.txt\n+++ b/CMakeLists.txt\n@@ -422,6 +422,19 @@ set(VLLM_MOE_EXT_SRC\n   \"csrc/moe/moe_align_sum_kernels.cu\"\n   \"csrc/moe/topk_softmax_kernels.cu\")\n \n+# Optimization flags for MoE kernels to improve align_block_size and sum kernels\n+set(VLLM_MOE_GPU_FLAGS ${VLLM_GPU_FLAGS})\n+if(VLLM_GPU_LANG STREQUAL \"CUDA\")\n+  list(APPEND VLLM_MOE_GPU_FLAGS\n+    \"--use_fast_math\"\n+    \"-O3\"\n+    \"--extra-device-vectorization\"\n+    \"-Xptxas=-v,-O3\"\n+    \"--maxrregcount=128\"\n+    \"-DNDEBUG\"\n+    \"--ftz=true\")\n+endif()\n+\n set_gencode_flags_for_srcs(\n   SRCS \"${VLLM_MOE_EXT_SRC}\"\n   CUDA_ARCHS \"${CUDA_ARCHS}\")\n@@ -457,7 +470,7 @@ define_gpu_extension_target(\n   DESTINATION vllm\n   LANGUAGE ${VLLM_GPU_LANG}\n   SOURCES ${VLLM_MOE_EXT_SRC}\n-  COMPILE_FLAGS ${VLLM_GPU_FLAGS}\n+  COMPILE_FLAGS ${VLLM_MOE_GPU_FLAGS}\n   ARCHITECTURES ${VLLM_GPU_ARCHES}\n   USE_SABI 3\n   WITH_SOABI)\n", "model_name_or_path": "gpt-5-2025-08-07"}
