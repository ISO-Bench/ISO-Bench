import os
import time

# Enable chunked prefill to exercise related config paths and logging
os.environ.setdefault("VLLM_ENABLE_CHUNKED_PREFILL", "1")

from vllm.config import VllmConfig
import vllm.envs as envs


def bench_config_inits(n: int = 200) -> float:
    t0 = time.time()
    for _ in range(n):
        # Minimal init; model_config left as None to avoid heavyweight I/O
        VllmConfig()
    return time.time() - t0


def bench_env_hash(m: int = 5000) -> tuple[float, str]:
    t0 = time.time()
    last = None
    for _ in range(m):
        last = envs.compute_hash()
    return time.time() - t0, last or ""


def main():
    n = int(os.getenv("BENCH_N", "200"))
    m = int(os.getenv("BENCH_M", "5000"))
    t_config = bench_config_inits(n)
    t_env, h = bench_env_hash(m)
    print(f"config_inits={n} time={t_config:.6f}s")
    print(f"env_hash_calls={m} time={t_env:.6f}s hash={h[:10]}")


if __name__ == "__main__":
    main()
