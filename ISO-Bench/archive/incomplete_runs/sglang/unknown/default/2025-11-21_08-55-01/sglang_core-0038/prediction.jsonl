{"instance_id": "/home/ubuntu/OmniPerf-Bench/sglan__repo-8f3173d", "model_patch": "diff --git a/python/sglang/srt/disaggregation/mooncake/conn.py b/python/sglang/srt/disaggregation/mooncake/conn.py\nindex db30d8c0d..6073ec9d5 100644\n--- a/python/sglang/srt/disaggregation/mooncake/conn.py\n+++ b/python/sglang/srt/disaggregation/mooncake/conn.py\n@@ -270,19 +270,18 @@ class MooncakeKVManager(BaseKVManager):\n \n         # Worker function for processing a single layer\n         def process_layer(src_ptr: int, dst_ptr: int, item_len: int) -> int:\n-            src_addr_list = []\n-            dst_addr_list = []\n-            length_list = []\n+            engine = self.engine  # local ref to avoid attribute lookups in loop\n             for prefill_index, decode_index in zip(prefill_kv_blocks, dst_kv_blocks):\n+                # Each block is contiguous; compute base addresses and total length\n                 src_addr = src_ptr + int(prefill_index[0]) * item_len\n                 dst_addr = dst_ptr + int(decode_index[0]) * item_len\n                 length = item_len * len(prefill_index)\n-                src_addr_list.append(src_addr)\n-                dst_addr_list.append(dst_addr)\n-                length_list.append(length)\n-            return self.engine.batch_transfer_sync(\n-                mooncake_session_id, src_addr_list, dst_addr_list, length_list\n-            )\n+                status = engine.transfer_sync(\n+                    mooncake_session_id, src_addr, dst_addr, length\n+                )\n+                if status != 0:\n+                    return status\n+            return 0\n \n         futures = [\n             executor.submit(\n@@ -397,9 +396,7 @@ class MooncakeKVManager(BaseKVManager):\n                 dst_offset,\n                 slice_lens_per_page,\n             ) = layer_params\n-            src_addr_list = []\n-            dst_addr_list = []\n-            length_list = []\n+            engine = self.engine  # local ref\n \n             # Calculate strides for a single token slot\n             bytes_per_token_on_prefill = src_item_len // page_size\n@@ -429,18 +426,22 @@ class MooncakeKVManager(BaseKVManager):\n                     src_slice_addr = src_token_slot_start_addr + src_offset\n                     dst_slice_addr = dst_token_slot_start_addr + dst_offset\n \n-                    src_addr_list.append(src_slice_addr)\n-                    dst_addr_list.append(dst_slice_addr)\n-                    length_list.append(slice_lens_per_page)\n+                    if logger.isEnabledFor(logging.DEBUG):\n+                        logger.debug(\n+                            f\"SYNC: sid={mooncake_session_id}, \"\n+                            f\"src={src_slice_addr}, dst={dst_slice_addr}, len={slice_lens_per_page}\"\n+                        )\n \n-                    logger.debug(\n-                        f\"SYNC: sid={mooncake_session_id}, \"\n-                        f\"src={src_slice_addr}, dst={dst_slice_addr}, len={slice_lens_per_page}\"\n+                    status = engine.transfer_sync(\n+                        mooncake_session_id,\n+                        src_slice_addr,\n+                        dst_slice_addr,\n+                        slice_lens_per_page,\n                     )\n+                    if status != 0:\n+                        return status\n \n-            return self.engine.batch_transfer_sync(\n-                mooncake_session_id, src_addr_list, dst_addr_list, length_list\n-            )\n+            return 0\n \n         futures = [\n             executor.submit(\n@@ -466,21 +467,19 @@ class MooncakeKVManager(BaseKVManager):\n         dst_aux_ptrs: list[int],\n         dst_aux_index: int,\n     ):\n-        src_addr_list = []\n-        dst_addr_list = []\n-        length_list = []\n+        engine = self.engine  # local ref\n         prefill_aux_ptrs = self.kv_args.aux_data_ptrs\n         prefill_aux_item_lens = self.kv_args.aux_item_lens\n         for i, dst_aux_ptr in enumerate(dst_aux_ptrs):\n             length = prefill_aux_item_lens[i]\n             src_addr = prefill_aux_ptrs[i] + length * prefill_aux_index\n-            dst_addr = dst_aux_ptrs[i] + length * dst_aux_index\n-            src_addr_list.append(src_addr)\n-            dst_addr_list.append(dst_addr)\n-            length_list.append(length)\n-        return self.engine.batch_transfer_sync(\n-            mooncake_session_id, src_addr_list, dst_addr_list, length_list\n-        )\n+            dst_addr = dst_aux_ptr + length * dst_aux_index\n+            status = engine.transfer_sync(\n+                mooncake_session_id, src_addr, dst_addr, length\n+            )\n+            if status != 0:\n+                return status\n+        return 0\n \n     def sync_status_to_decode_endpoint(\n         self, remote: str, dst_port: int, room: int, status: int, prefill_rank: int\n", "model_name_or_path": "gpt-5-2025-08-07"}
