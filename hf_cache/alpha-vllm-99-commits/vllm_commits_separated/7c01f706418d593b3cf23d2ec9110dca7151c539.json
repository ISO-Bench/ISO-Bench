{
  "commit_hash": "7c01f706418d593b3cf23d2ec9110dca7151c539",
  "pr_url": "https://github.com/vllm-project/vllm/pull/5974",
  "pr_date": "2024-06-29",
  "timeline_text": "Copy link Collaborator Yard1 commented Jun 28, 2024 This is a small performance tweak - we call SequenceStatus.is_finished very often, and each time we used to create a list. By switching to an IntEnum , we can do a simple is greater comparison, speeding things up. PR Checklist (Click to Expand) Thank you for your contribution to vLLM! Before submitting the pull request, please ensure the PR meets the following criteria. This helps vLLM maintain the code quality and improve the efficiency of the review process. PR Title and Classification Only specific types of PRs will be reviewed. The PR title is prefixed appropriately to indicate the type of change. Please use one of the following: [Bugfix] for bug fixes. [CI/Build] for build or continuous integration improvements. [Doc] for documentation fixes and improvements. [Model] for adding a new model or improving an existing model. Model name should appear in the title. [Frontend] For changes on the vLLM frontend (e.g., OpenAI API server, LLM class, etc.) [Kernel] for changes affecting CUDA kernels or other compute kernels. [Core] for changes in the core vLLM logic (e.g., LLMEngine , AsyncLLMEngine , Scheduler , etc.) [Hardware][Vendor] for hardware-specific changes. Vendor name should appear in the prefix (e.g., [Hardware][AMD] ). [Misc] for PRs that do not fit the above categories. Please use this sparingly. Note: If the PR spans more than one category, please include all relevant prefixes. Code Quality The PR need to meet the following code quality standards: We adhere to Google Python style guide and Google C++ style guide . Pass all linter checks. Please use format.sh to format your code. The code need to be well-documented to ensure future contributors can easily understand the code. Include sufficient tests to ensure the project to stay correct and robust. This includes both unit tests and integration tests. Please add documentation to docs/source/ if the PR modifies the user-facing behaviors of vLLM. It helps vLLM user understand and utilize the new features or changes. Notes for Large Changes Please keep the changes as concise as possible. For major architectural changes (>500 LOC excluding kernel/data/config/test), we would expect a GitHub issue (RFC) discussing the technical design and justification. Otherwise, we will tag it with rfc-required and might not go through the PR. What to Expect for the Reviews The goal of the vLLM team is to be a transparent reviewing machine . We would like to make the review process transparent and efficient and make sure no contributor feel confused or frustrated. However, the vLLM team is small, so we need to prioritize some PRs over others. Here is what you can expect from the review process: After the PR is submitted, the PR will be assigned to a reviewer. Every reviewer will pick up the PRs based on their expertise and availability. After the PR is assigned, the reviewer will provide status update every 2-3 days. If the PR is not reviewed within 7 days, please feel free to ping the reviewer or the vLLM team. After the review, the reviewer will put an action-required label on the PR if there are changes required. The contributor should address the comments and ping the reviewer to re-review the PR. Please respond to all comments within a reasonable time frame. If a comment isn't clear or you disagree with a suggestion, feel free to ask for clarification or discuss the suggestion. Thank You Finally, thank you for taking the time to read these guidelines and for your interest in contributing to vLLM. Your contributions make vLLM a great tool for everyone! Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . All reactions Optimize SequenceStatus.is_finished by switching to IntEnum 2df4810 youkaichao approved these changes Jun 28, 2024 View reviewed changes Copy link Member youkaichao left a comment There was a problem hiding this comment. Choose a reason for hiding this comment The reason will be displayed to describe this comment to others. Learn more . Choose a reason Spam Abuse Off Topic Outdated Duplicate Resolved Hide comment LGTM Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . All reactions Yard1 enabled auto-merge (squash) June 28, 2024 23:42 Yard1 merged commit 7c01f70 into main Jun 29, 2024 robertgshaw2-redhat pushed a commit\n        to neuralmagic/nm-vllm\n      that referenced\n      this pull request Jul 1, 2024 [Core] Optimize SequenceStatus.is_finished by switching to IntEnum ( v… … 270105d …llm-project#5974 ) prashantgupta24 pushed a commit\n        to opendatahub-io/vllm\n      that referenced\n      this pull request Jul 1, 2024 [Core] Optimize SequenceStatus.is_finished by switching to IntEnum ( v… … 01789ba …llm-project#5974 ) prashantgupta24 pushed a commit\n        to opendatahub-io/vllm\n      that referenced\n      this pull request Jul 1, 2024 [Core] Optimize SequenceStatus.is_finished by switching to IntEnum ( v… … 4951f09 …llm-project#5974 ) kzawora-intel added a commit\n        to HabanaAI/vllm-fork\n      that referenced\n      this pull request Jul 2, 2024 habana_main rebase ( #71 ) … 5e1a565 * [Hardware][Intel] Optimize CPU backend and add more performance tips ( vllm-project#4971 )\n\nCo-authored-by: Jianan Gu <jianan.gu@intel.com>\n\n* [Docs] Add 4th meetup slides ( vllm-project#5509 )\n\n* [Misc] Add vLLM version getter to utils ( vllm-project#5098 )\n\n* [CI/Build] Simplify OpenAI server setup in tests ( vllm-project#5100 )\n\n* [Doc] Update LLaVA docs ( vllm-project#5437 )\n\nCo-authored-by: Roger Wang <ywang@roblox.com>\n\n* [Kernel] Factor out epilogues from cutlass kernels ( vllm-project#5391 )\n\nCo-authored-by: Michael Goin <michael@neuralmagic.com>\nCo-authored-by: youkaichao <youkaichao@gmail.com>\nCo-authored-by: zifeitong <zifei.tong@parasail.io>\nCo-authored-by: Robert Shaw <114415538+robertgshaw2-neuralmagic@users.noreply.github.com>\n\n* [MISC] Remove FP8 warning ( vllm-project#5472 )\n\nCo-authored-by: Philipp Moritz <pcmoritz@gmail.com>\n\n* Seperate dev requirements into lint and test ( vllm-project#5474 )\n\n* Revert \"[Core] Remove unnecessary copies in flash attn backend\" ( vllm-project#5478 )\n\n* [misc] fix format.sh ( vllm-project#5511 )\n\n* [CI/Build] Disable test_fp8.py ( vllm-project#5508 )\n\n* [Kernel] Disable CUTLASS kernels for fp8 ( vllm-project#5505 )\n\n* Add `cuda_device_count_stateless` ( vllm-project#5473 )\n\n* [Hardware][Intel] Support CPU inference with AVX2 ISA ( vllm-project#5452 )\n\n* [Misc] Fix arg names in quantizer script ( vllm-project#5507 )\n\n* bump version to v0.5.0.post1 ( vllm-project#5522 )\n\n* [CI/Build][Misc] Add CI that benchmarks vllm performance on those PRs with `perf-benchmarks` label ( vllm-project#5073 )\n\nCo-authored-by: simon-mo <simon.mo@hey.com>\n\n* [CI/Build] Disable LLaVA-NeXT CPU test ( vllm-project#5529 )\n\n* [Kernel] Fix CUTLASS 3.x custom broadcast load epilogue ( vllm-project#5516 )\n\n* [Misc] Fix arg names ( vllm-project#5524 )\n\n* [ Misc ] Rs/compressed tensors cleanup ( vllm-project#5432 )\n\nCo-authored-by: mgoin <michael@neuralmagic.com>\nCo-authored-by: Dipika Sikka <dipikasikka1@gmail.com>\n\n* [Kernel] Suppress mma.sp warning on CUDA 12.5 and later ( vllm-project#5401 )\n\n* [mis] fix flaky test of test_cuda_device_count_stateless ( vllm-project#5546 )\n\n* [Core] Remove duplicate processing in async engine ( vllm-project#5525 )\n\n* [misc][distributed] fix benign error in `is_in_the_same_node` ( vllm-project#5512 )\n\n* [Docs] Add ZhenFund as a Sponsor ( vllm-project#5548 )\n\n* [Doc] Update documentation on Tensorizer ( vllm-project#5471 )\n\n* [Bugfix] Enable loading FP8 checkpoints for gpt_bigcode models  ( vllm-project#5460 )\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\n\n* [Bugfix] Fix typo in Pallas backend ( vllm-project#5558 )\n\n* [Core][Distributed] improve p2p cache generation ( vllm-project#5528 )\n\n* Add ccache to amd ( vllm-project#5555 )\n\n* [Core][Bugfix]: fix prefix caching for blockv2 ( vllm-project#5364 )\n\nSigned-off-by: Lei Wen <wenlei03@qiyi.com>\nCo-authored-by: Lei Wen <wenlei03@qiyi.com>\n\n* [mypy] Enable type checking for test directory ( vllm-project#5017 )\n\n* [CI/Build] Test both text and token IDs in batched OpenAI Completions API ( vllm-project#5568 )\n\n* [misc] Do not allow to use lora with chunked prefill. ( vllm-project#5538 )\n\nCo-authored-by: Cyrus Leung <tlleungac@connect.ust.hk>\n\n* add gptq_marlin test for bug report vllm-project#5088 ( vllm-project#5145 )\n\n* [BugFix] Don't start a Ray cluster when not using Ray ( vllm-project#5570 )\n\n* [Fix] Correct OpenAI batch response format ( vllm-project#5554 )\n\n* Add basic correctness 2 GPU tests to 4 GPU pipeline ( vllm-project#5518 )\n\n* [CI][BugFix] Flip is_quant_method_supported condition ( vllm-project#5577 )\n\n* [build][misc] limit numpy version ( vllm-project#5582 )\n\n* [Doc] add debugging tips for crash and multi-node debugging ( vllm-project#5581 )\n\n* Fix w8a8 benchmark and add Llama-3-8B ( vllm-project#5562 )\n\n* [Model] Rename Phi3 rope scaling type ( vllm-project#5595 )\n\n* Correct alignment in the seq_len diagram. ( vllm-project#5592 )\n\nCo-authored-by: Liqian Chen <liqian.chen@deeplang.ai>\n\n* [Kernel] `compressed-tensors` marlin 24 support ( vllm-project#5435 )\n\n* [Misc] use AutoTokenizer for benchmark serving when vLLM not installed ( vllm-project#5588 )\n\n* [Hardware][Intel GPU] Add Intel GPU(XPU) inference backend ( vllm-project#3814 )\n\nCo-authored-by: Jiang Li <jiang1.li@intel.com>\nCo-authored-by: Abhilash Majumder <abhilash.majumder@intel.com>\nCo-authored-by: Abhilash Majumder <30946547+abhilash1910@users.noreply.github.com>\n\n* [CI/BUILD] Support non-AVX512 vLLM building and testing ( vllm-project#5574 )\n\n* [CI] the readability of benchmarking and prepare for dashboard ( vllm-project#5571 )\n\n[CI] Improve the readability of performance benchmarking results and prepare for upcoming performance dashboard ( vllm-project#5571 )\n\n* [bugfix][distributed] fix 16 gpus local rank arrangement ( vllm-project#5604 )\n\n* [Optimization] use a pool to reuse LogicalTokenBlock.token_ids ( vllm-project#5584 )\n\n* [Bugfix] Fix KV head calculation for MPT models when using GQA ( vllm-project#5142 )\n\n* [Fix] Use utf-8 encoding in entrypoints/openai/run_batch.py ( vllm-project#5606 )\n\n* [Speculative Decoding 1/2 ] Add typical acceptance sampling as one of the sampling techniques in the verifier ( vllm-project#5131 )\n\n* [Model] Initialize Phi-3-vision support ( vllm-project#4986 )\n\n* [Kernel] Add punica dimensions for Granite 13b ( vllm-project#5559 )\n\nSigned-off-by: Joe Runde <Joseph.Runde@ibm.com>\n\n* [misc][typo] fix typo ( vllm-project#5620 )\n\n* [Misc] Fix typo ( vllm-project#5618 )\n\n* [CI] Avoid naming different metrics with the same name in performance benchmark ( vllm-project#5615 )\n\n* [bugfix][distributed] improve p2p capability test ( vllm-project#5612 )\n\n[bugfix][distributed] do not error if two processes do not agree on p2p capability ( vllm-project#5612 )\n\n* [Misc] Remove import from transformers logging ( vllm-project#5625 )\n\n* [CI/Build][Misc] Update Pytest Marker for VLMs ( vllm-project#5623 )\n\n* [ci] Deprecate original CI template ( vllm-project#5624 )\n\nSigned-off-by: kevin <kevin@anyscale.com>\n\n* [Misc] Add OpenTelemetry support ( vllm-project#4687 )\n\nThis PR adds basic support for OpenTelemetry distributed tracing.\nIt includes changes to enable tracing functionality and improve monitoring capabilities.\n\nI've also added a markdown with print-screens to guide users how to use this feature. You can find it here\n\n* [Misc] Add channel-wise quantization support for w8a8 dynamic per token activation quantization ( vllm-project#5542 )\n\n* [ci] Setup Release pipeline and build release wheels with cache ( vllm-project#5610 )\n\nSigned-off-by: kevin <kevin@anyscale.com>\n\n* [Model] LoRA support added for command-r ( vllm-project#5178 )\n\n* [Bugfix] Fix for inconsistent behaviour related to sampling and repetition penalties  ( vllm-project#5639 )\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\n\n* [Doc] Added cerebrium as Integration option ( vllm-project#5553 )\n\n* [Bugfix] Fix CUDA version check for mma warning suppression ( vllm-project#5642 )\n\n* [Bugfix] Fix w8a8 benchmarks for int8 case ( vllm-project#5643 )\n\n* [Bugfix] Fix Phi-3 Long RoPE scaling implementation ( vllm-project#5628 )\n\n* [Bugfix] Added test for sampling repetition penalty bug. ( vllm-project#5659 )\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\n\n* [Bugfix][CI/Build][AMD][ROCm]Fixed the cmake build bug which generate garbage on certain devices ( vllm-project#5641 )\n\n* [misc][distributed] use 127.0.0.1 for single-node ( vllm-project#5619 )\n\n* [Model] Add FP8 kv cache for Qwen2 ( vllm-project#5656 )\n\n* [Bugfix] Fix sampling_params passed incorrectly in Phi3v example ( vllm-project#5684 )\n\n* [Misc]Add param max-model-len in benchmark_latency.py ( vllm-project#5629 )\n\n* [CI/Build] Add tqdm to dependencies ( vllm-project#5680 )\n\n* [ci] Add A100 queue into AWS CI template ( vllm-project#5648 )\n\nSigned-off-by: kevin <kevin@anyscale.com>\n\n* [Frontend][Bugfix] Fix preemption_mode -> preemption-mode for CLI arg in arg_utils.py ( vllm-project#5688 )\n\n* [ci][distributed] add tests for custom allreduce ( vllm-project#5689 )\n\n* [Bugfix] AsyncLLMEngine hangs with asyncio.run ( vllm-project#5654 )\n\n* [Doc] Update docker references ( vllm-project#5614 )\n\nSigned-off-by: Rafael Vasquez <rafvasq21@gmail.com>\n\n* [Misc] Add per channel support for static activation quantization; update w8a8 schemes to share base classes ( vllm-project#5650 )\n\n* [ci] Limit num gpus if specified for A100 ( vllm-project#5694 )\n\nSigned-off-by: kevin <kevin@anyscale.com>\n\n* [Misc] Improve conftest ( vllm-project#5681 )\n\n* [Bugfix][Doc] FIx Duplicate Explicit Target Name Errors ( vllm-project#5703 )\n\n* [Kernel] Update Cutlass int8 kernel configs for SM90 ( vllm-project#5514 )\n\nCo-authored-by: Varun Sundar Rabindranath <varun@neuralmagic.com>\n\n* [Model] Port over CLIPVisionModel for VLMs ( vllm-project#5591 )\n\n* [Kernel] Update Cutlass int8 kernel configs for SM80 ( vllm-project#5275 )\n\nCo-authored-by: Varun Sundar Rabindranath <varun@neuralmagic.com>\n\n* [Bugfix] Fix the CUDA version check for FP8 support in the CUTLASS kernels ( vllm-project#5715 )\n\n* [Frontend] Add FlexibleArgumentParser to support both underscore and dash in names ( vllm-project#5718 )\n\n* [distributed][misc] use fork by default for mp ( vllm-project#5669 )\n\n* [Model] MLPSpeculator speculative decoding support ( vllm-project#4947 )\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\n\nCo-authored-by: Thomas Parnell <tpa@zurich.ibm.com>\nCo-authored-by: Nick Hill <nickhill@us.ibm.com>\nCo-authored-by: Davis Wertheimer <Davis.Wertheimer@ibm.com>\n\n* [Kernel] Add punica dimension for Qwen2 LoRA ( vllm-project#5441 )\n\n* [BugFix] Fix test_phi3v.py ( vllm-project#5725 )\n\n* [Bugfix] Add  fully sharded layer for QKVParallelLinearWithLora ( vllm-project#5665 )\n\nCo-authored-by: Antoni Baum <antoni.baum@protonmail.com>\n\n* [Core][Distributed] add shm broadcast ( vllm-project#5399 )\n\nCo-authored-by: Cody Yu <hao.yu.cody@gmail.com>\n\n* [Kernel][CPU] Add Quick `gelu` to CPU ( vllm-project#5717 )\n\n* [Doc] Documentation on supported hardware for quantization methods ( vllm-project#5745 )\n\n* [BugFix] exclude version 1.15.0 for modelscope ( vllm-project#5668 )\n\n* [ci][test] fix ca test in main ( vllm-project#5746 )\n\n* [LoRA] Add support for pinning lora adapters in the LRU cache ( vllm-project#5603 )\n\n* [CI][Hardware][Intel GPU] add Intel GPU(XPU) ci pipeline ( vllm-project#5616 )\n\n* [Model] Support Qwen-VL and Qwen-VL-Chat models with text-only inputs ( vllm-project#5710 )\n\nCo-authored-by: Roger Wang <ywang@roblox.com>\n\n* [Misc] Remove vllm-project#4789 workaround left in vllm/entrypoints/openai/run_batch.py ( vllm-project#5756 )\n\n* [Bugfix] Fix pin_lora error in TPU executor ( vllm-project#5760 )\n\n* [Docs][TPU] Add installation tip for TPU ( vllm-project#5761 )\n\n* [core][distributed] improve shared memory broadcast ( vllm-project#5754 )\n\n* [BugFix] [Kernel] Add Cutlass2x fallback kernels ( vllm-project#5744 )\n\nCo-authored-by: Varun Sundar Rabindranath <varun@neuralmagic.com>\n\n* [Distributed] Add send and recv helpers ( vllm-project#5719 )\n\n* [Bugfix] Add phi3v resize for dynamic shape and fix torchvision requirement ( vllm-project#5772 )\n\n* [doc][faq] add warning to download models for every nodes ( vllm-project#5783 )\n\n* post-rebase api adjustments\n\n* [Doc] Add \"Suggest edit\" button to doc pages ( vllm-project#5789 )\n\n* [Doc] Add Phi-3-medium to list of supported models ( vllm-project#5788 )\n\n* [Bugfix] Fix FlexibleArgumentParser replaces _ with - for actual args ( vllm-project#5795 )\n\n* [ci] Remove aws template ( vllm-project#5757 )\n\nSigned-off-by: kevin <kevin@anyscale.com>\n\n* [Doc] Add notice about breaking changes to VLMs ( vllm-project#5818 )\n\n* [Speculative Decoding] Support draft model on different tensor-parallel size than target model ( vllm-project#5414 )\n\n* add pin_lora to habana components\n\n* add WA for model loader\n\n* fix api mismatches with ray\n\n* tensor parallel fixes\n\n* workers cpu alignment fix\n\n* [Misc] Remove useless code in cpu_worker ( vllm-project#5824 )\n\n* prefill/decode metadata fixes\n\n* [Core] Add fault tolerance for `RayTokenizerGroupPool` ( vllm-project#5748 )\n\n* re-enable attn metadata trimming\n\n* worker_use_ray fix\n\n* [doc][distributed] add both gloo and nccl tests ( vllm-project#5834 )\n\n* [CI/Build] Add unit testing for FlexibleArgumentParser ( vllm-project#5798 )\n\n* [Misc] Update `w4a16` `compressed-tensors` support to include `w8a16` ( vllm-project#5794 )\n\n* [Hardware][TPU] Refactor TPU backend ( vllm-project#5831 )\n\n* [Hardware][AMD][CI/Build][Doc] Upgrade to ROCm 6.1, Dockerfile improvements, test fixes ( vllm-project#5422 )\n\n* [Hardware][TPU] Raise errors for unsupported sampling params ( vllm-project#5850 )\n\n* [CI/Build] Add E2E tests for MLPSpeculator ( vllm-project#5791 )\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\n\n* [Bugfix] Fix assertion in NeuronExecutor ( vllm-project#5841 )\n\n* [Core] Refactor Worker and ModelRunner to consolidate control plane communication ( vllm-project#5408 )\n\nSigned-off-by: Stephanie Wang <swang@cs.berkeley.edu>\nSigned-off-by: Stephanie <swang@anyscale.com>\nCo-authored-by: Stephanie <swang@anyscale.com>\n\n* [Misc][Doc] Add Example of using OpenAI Server with VLM ( vllm-project#5832 )\n\n* [bugfix][distributed] fix shm broadcast when the queue size is full ( vllm-project#5801 )\n\n* [Bugfix] Fix embedding to support 2D inputs ( vllm-project#5829 )\n\n* [Bugfix][TPU] Fix KV cache size calculation ( vllm-project#5860 )\n\n* [CI/Build] Refactor image test assets ( vllm-project#5821 )\n\n* [Kernel] Adding bias epilogue support for `cutlass_scaled_mm` ( vllm-project#5560 )\n\nCo-authored-by: Chih-Chieh-Yang <7364402+cyang49@users.noreply.github.com>\nCo-authored-by: Lucas Wilkinson <lwilkinson@neuralmagic.com>\n\n* [Frontend] Add tokenize/detokenize endpoints ( vllm-project#5054 )\n\n* [Hardware][TPU] Support parallel sampling & Swapping ( vllm-project#5855 )\n\n* [Bugfix][TPU] Fix CPU cache allocation ( vllm-project#5869 )\n\n* Support CPU inference with VSX PowerPC ISA ( vllm-project#5652 )\n\n* [doc] update usage of env var to avoid conflict ( vllm-project#5873 )\n\n* [Misc] Add example for LLaVA-NeXT ( vllm-project#5879 )\n\n* [BugFix] Fix cuda graph for MLPSpeculator ( vllm-project#5875 )\n\nCo-authored-by: Abhinav Goyal <abhinav.goyal@flipkart.com>\n\n* [Doc] Add note about context length in Phi-3-Vision example ( vllm-project#5887 )\n\n* [VLM][Bugfix] Make sure that `multi_modal_kwargs` is broadcasted properly ( vllm-project#5880 )\n\nSigned-off-by: Xiaowei Jiang <xwjiang2010@gmail.com>\n\n* [Model] Add base class for LoRA-supported models ( vllm-project#5018 )\n\n* [Bugfix] Fix img_sizes Parsing in Phi3-Vision ( vllm-project#5888 )\n\n* [CI/Build] [1/3] Reorganize entrypoints tests ( vllm-project#5526 )\n\n* add collective crash WA\n\n* add comment to the weird mark_step\n\n* [Model][Bugfix] Implicit model flags and reenable Phi-3-Vision ( vllm-project#5896 )\n\n* [doc][misc] add note for Kubernetes users ( vllm-project#5916 )\n\n* [BugFix] Fix `MLPSpeculator` handling of `num_speculative_tokens` ( vllm-project#5876 )\n\n* [BugFix] Fix `min_tokens` behaviour for multiple eos tokens ( vllm-project#5849 )\n\n* [CI/Build] Fix Args for `_get_logits_warper` in Sampler Test ( vllm-project#5922 )\n\n* [Model] Add Gemma 2 ( vllm-project#5908 )\n\n* [core][misc] remove logical block ( vllm-project#5882 )\n\n* [Kernel][ROCm][AMD] fused_moe Triton configs v2 for mi300X ( vllm-project#5932 )\n\n* [Hardware][TPU] Optimize KV cache swapping ( vllm-project#5878 )\n\n* [VLM][BugFix] Make sure that `multi_modal_kwargs` can broadcast properly with ring buffer. ( vllm-project#5905 )\n\nSigned-off-by: Xiaowei Jiang <xwjiang2010@gmail.com>\nCo-authored-by: Roger Wang <ywang@roblox.com>\n\n* [Bugfix][Hardware][Intel CPU] Fix unpassed multi_modal_kwargs for CPU runner ( vllm-project#5956 )\n\n* [Core] Registry for processing model inputs ( vllm-project#5214 )\n\nCo-authored-by: ywang96 <ywang@roblox.com>\n\n* Unmark fused_moe config json file as executable ( vllm-project#5960 )\n\n* [Hardware][Intel] OpenVINO vLLM backend ( vllm-project#5379 )\n\n* [Bugfix] Better error message for MLPSpeculator when `num_speculative_tokens` is set too high ( vllm-project#5894 )\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\n\n* [CI/Build] [2/3] Reorganize entrypoints tests ( vllm-project#5904 )\n\n* [Distributed] Make it clear that % should not be in tensor dict keys. ( vllm-project#5927 )\n\nSigned-off-by: Xiaowei Jiang <xwjiang2010@gmail.com>\n\n* [Spec Decode] Introduce DraftModelRunner ( vllm-project#5799 )\n\n* [Bugfix] Fix compute datatype for cutlass 3.x epilogues ( vllm-project#5931 )\n\n* [ Misc ] Remove `fp8_shard_indexer` from Col/Row Parallel Linear (Simplify Weight Loading) ( vllm-project#5928 )\n\nCo-authored-by: Robert Shaw <rshaw@neuralmagic>\n\n* [ Bugfix ] Enabling Loading Models With Fused QKV/MLP on Disk with FP8 ( vllm-project#5921 )\n\nCo-authored-by: Robert Shaw <rshaw@neuralmagic>\n\n* Support Deepseek-V2 ( vllm-project#4650 )\n\nCo-authored-by: Philipp Moritz <pcmoritz@gmail.com>\n\n* [Bugfix] Only add `Attention.kv_scale` if kv cache quantization is enabled ( vllm-project#5936 )\n\n* Unmark more files as executable ( vllm-project#5962 )\n\n* [Bugfix] Fix Engine Failing After Invalid Request - AsyncEngineDeadError ( vllm-project#5963 )\n\nCo-authored-by: Robert Shaw <rshaw@neuralmagic>\n\n* [Kernel] Flashinfer for prefill & decode, with Cudagraph support for decode ( vllm-project#4628 )\n\nCo-authored-by: LiuXiaoxuanPKU <llilyliupku@gmail.com>, bong-furiosa <bongwon.jang@furiosa.ai>\n\n* [Bugfix][TPU] Fix TPU sampler output ( vllm-project#5978 )\n\n* [Bugfix][TPU] Fix pad slot id ( vllm-project#5977 )\n\n* [Bugfix] fix missing last itl in openai completions benchmark ( vllm-project#5926 )\n\n* [Misc] Extend vLLM Metrics logging API ( vllm-project#5925 )\n\nCo-authored-by: Antoni Baum <antoni.baum@protonmail.com>\n\n* [Kernel] Add punica dimensions for Granite 3b and 8b ( vllm-project#5930 )\n\nSigned-off-by: Joe Runde <joe@joerun.de>\n\n* [Bugfix] Fix precisions in Gemma 1 ( vllm-project#5913 )\n\n* [Misc] Update Phi-3-Vision Example ( vllm-project#5981 )\n\nCo-authored-by: Cyrus Leung <cyrus.tl.leung@gmail.com>\n\n* [Bugfix] Support `eos_token_id` from `config.json` ( vllm-project#5954 )\n\n* [Core] Optimize `SequenceStatus.is_finished` by switching to IntEnum ( vllm-project#5974 )\n\n* [Kernel] Raise an exception in MoE kernel if the batch size is larger then 65k ( vllm-project#5939 )\n\n* [ CI/Build ] Added E2E Test For Compressed Tensors ( vllm-project#5839 )\n\nCo-authored-by: Michael Goin <michael@neuralmagic.com>\nCo-authored-by: Robert Shaw <rshaw@neuralmagic>\n\n* [CI/Build] Add TP test for vision models ( vllm-project#5892 )\n\n* [ CI/Build ] LM Eval Harness Based CI Testing ( vllm-project#5838 )\n\nCo-authored-by: Robert Shaw <rshaw@neuralmagic>\n\n* [Bugfix][CI/Build][Hardware][AMD] Install matching torchvision to fix AMD tests ( vllm-project#5949 )\n\n* [CI/Build] Temporarily Remove Phi3-Vision from TP Test ( vllm-project#5989 )\n\n* [CI/Build] Reuse code for checking output consistency ( vllm-project#5988 )\n\n* [CI/Build] [3/3] Reorganize entrypoints tests ( vllm-project#5966 )\n\n* [ci][distributed] fix device count call\n\n[ci][distributed] fix some cuda init that makes it necessary to use spawn ( vllm-project#5991 )\n\n* [Frontend]: Support base64 embedding ( vllm-project#5935 )\n\nCo-authored-by: Cyrus Leung <cyrus.tl.leung@gmail.com>\n\n* [Lora] Use safetensor keys instead of adapter_config.json to find unexpected modules.  ( vllm-project#5909 )\n\nCo-authored-by: sang <sangcho@anyscale.com>\n\n* [ CI ] Temporarily Disable Large LM-Eval Tests ( vllm-project#6005 )\n\nCo-authored-by: rshaw@neuralmagic.com <rshaw@neuralmagic>\n\n* [Misc] Fix `get_min_capability` ( vllm-project#5971 )\n\n* [ Misc ] Refactor w8a8 to use `process_weights_after_load` (Simplify Weight Loading) ( vllm-project#5940 )\n\nCo-authored-by: Robert Shaw <rshaw@neuralmagic>\n\n* [misc][cuda] use nvml to avoid accidentally cuda initialization ( vllm-project#6007 )\n\n* [Speculative Decoding 2/2 ] Integrate typical acceptance sampler into Spec Decode Worker ( vllm-project#5348 )\n\n* Revert test changes\n\n* cleanup\n\n* llm engine cleanup\n\n* utils.py cleanup\n\n* custom ops refactor\n\n* move xops to ops\n\n* remove vllm/hpu/attn_bias.py\n\n* whitespace fix\n\n* revert accidental changes in rmsnorm\n\n* Fix hpugraph hashing\n\n* add trim_attn_metadata comment\n\n* fix prompt bucketing:\n\n* [ CI ] Re-enable Large Model LM Eval ( vllm-project#6031 )\n\n* [doc][misc] remove deprecated api server in doc ( vllm-project#6037 )\n\n* [Misc] update benchmark backend for scalellm ( vllm-project#6018 )\n\n* [doc][misc] further lower visibility of simple api server ( vllm-project#6041 )\n\nCo-authored-by: Simon Mo <simon.mo@hey.com>\n\n* [Bugfix] Use RayActorError for older versions of Ray in  RayTokenizerGroupPool ( vllm-project#6039 )\n\n* [Bugfix] adding chunking mechanism to fused_moe to handle large inputs ( vllm-project#6029 )\n\n* add FAQ doc under 'serving' ( vllm-project#5946 )\n\n* [Bugfix][Doc] Fix Doc Formatting ( vllm-project#6048 )\n\n* [Bugfix] Add explicit `end_forward` calls to flashinfer ( vllm-project#6044 )\n\n* [BugFix] Ensure worker model loop is always stopped at the right time ( vllm-project#5987 )\n\n* [Frontend] Relax api url assertion for openai benchmarking ( vllm-project#6046 )\n\n* [Model] Changes to MLPSpeculator to support tie_weights and input_scale ( vllm-project#5965 )\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\nCo-authored-by: Joshua Rosenkranz <jmrosenk@us.ibm.com>\n\n* [Core] Optimize block_manager_v2 vs block_manager_v1 (to make V2 default)  ( vllm-project#5602 )\n\n* [Frontend] Add template related params to request ( vllm-project#5709 )\n\n* [VLM] Remove `image_input_type` from VLM config ( vllm-project#5852 )\n\nSigned-off-by: Xiaowei Jiang <xwjiang2010@gmail.com>\nCo-authored-by: Cyrus Leung <cyrus.tl.leung@gmail.com>\nCo-authored-by: Roger Wang <ywang@roblox.com>\n\n* [Doc] Reinstate doc dependencies ( vllm-project#6061 )\n\n* guard model loader wa for hpu\n\n---------\n\nSigned-off-by: Thomas Parnell <tpa@zurich.ibm.com>\nSigned-off-by: Lei Wen <wenlei03@qiyi.com>\nSigned-off-by: Joe Runde <Joseph.Runde@ibm.com>\nSigned-off-by: kevin <kevin@anyscale.com>\nSigned-off-by: Rafael Vasquez <rafvasq21@gmail.com>\nSigned-off-by: Stephanie Wang <swang@cs.berkeley.edu>\nSigned-off-by: Stephanie <swang@anyscale.com>\nSigned-off-by: Xiaowei Jiang <xwjiang2010@gmail.com>\nSigned-off-by: Joe Runde <joe@joerun.de>\nCo-authored-by: Li, Jiang <jiang1.li@intel.com>\nCo-authored-by: Jianan Gu <jianan.gu@intel.com>\nCo-authored-by: Woosuk Kwon <woosuk.kwon@berkeley.edu>\nCo-authored-by: Cyrus Leung <tlleungac@connect.ust.hk>\nCo-authored-by: Roger Wang <ywang@roblox.com>\nCo-authored-by: Tyler Michael Smith <tyler@neuralmagic.com>\nCo-authored-by: Michael Goin <michael@neuralmagic.com>\nCo-authored-by: youkaichao <youkaichao@gmail.com>\nCo-authored-by: zifeitong <zifei.tong@parasail.io>\nCo-authored-by: Robert Shaw <114415538+robertgshaw2-neuralmagic@users.noreply.github.com>\nCo-authored-by: Cody Yu <hao.yu.cody@gmail.com>\nCo-authored-by: Philipp Moritz <pcmoritz@gmail.com>\nCo-authored-by: Antoni Baum <antoni.baum@protonmail.com>\nCo-authored-by: Jie Fu (傅杰) <jiefu@tencent.com>\nCo-authored-by: Allen.Dou <allen.dou@hotmail.com>\nCo-authored-by: Simon Mo <simon.mo@hey.com>\nCo-authored-by: Kuntai Du <kuntai@uchicago.edu>\nCo-authored-by: Dipika Sikka <dipikasikka1@gmail.com>\nCo-authored-by: Sanger Steel <sangersteel@gmail.com>\nCo-authored-by: Thomas Parnell <tpa@zurich.ibm.com>\nCo-authored-by: leiwen83 <leiwen83@users.noreply.github.com>\nCo-authored-by: Lei Wen <wenlei03@qiyi.com>\nCo-authored-by: SangBin Cho <rkooo567@gmail.com>\nCo-authored-by: Alexander Matveev <59768536+alexm-neuralmagic@users.noreply.github.com>\nCo-authored-by: Nick Hill <nickhill@us.ibm.com>\nCo-authored-by: Amit Garg <gargamit@microsoft.com>\nCo-authored-by: Charles Riggins <liqianchen123@foxmail.com>\nCo-authored-by: Liqian Chen <liqian.chen@deeplang.ai>\nCo-authored-by: zhyncs <me@zhyncs.com>\nCo-authored-by: Kunshang Ji <kunshang.ji@intel.com>\nCo-authored-by: Abhilash Majumder <abhilash.majumder@intel.com>\nCo-authored-by: Abhilash Majumder <30946547+abhilash1910@users.noreply.github.com>\nCo-authored-by: Bruce Fontaine <bruce@2.7182.net>\nCo-authored-by: zifeitong <zifeitong@gmail.com>\nCo-authored-by: sroy745 <142070531+sroy745@users.noreply.github.com>\nCo-authored-by: Isotr0py <2037008807@qq.com>\nCo-authored-by: Joe Runde <joe@joerun.de>\nCo-authored-by: Chang Su <chang.s.su@oracle.com>\nCo-authored-by: Roger Wang <136131678+ywang96@users.noreply.github.com>\nCo-authored-by: Kevin H. Luu <kevin@anyscale.com>\nCo-authored-by: Ronen Schaffer <ronen.schaffer@ibm.com>\nCo-authored-by: sergey-tinkoff <167607910+sergey-tinkoff@users.noreply.github.com>\nCo-authored-by: milo157 <43028253+milo157@users.noreply.github.com>\nCo-authored-by: Shukant Pal <SukantK2002@outlook.com>\nCo-authored-by: Hongxia Yang <62075498+hongxiayang@users.noreply.github.com>\nCo-authored-by: DearPlanet <junsong.zhang2021.work@outlook.com>\nCo-authored-by: Rafael Vasquez <rafvasq21@gmail.com>\nCo-authored-by: Varun Sundar Rabindranath <varunsundar08@gmail.com>\nCo-authored-by: Varun Sundar Rabindranath <varun@neuralmagic.com>\nCo-authored-by: Joshua Rosenkranz <joshua.rosenkranz@gmail.com>\nCo-authored-by: Davis Wertheimer <Davis.Wertheimer@ibm.com>\nCo-authored-by: Jinzhen Lin <linjinzhen@hotmail.com>\nCo-authored-by: Jee Li <pandaleefree@163.com>\nCo-authored-by: rohithkrn <rohith.nallamaddi@gmail.com>\nCo-authored-by: Murali Andoorveedu <37849411+andoorve@users.noreply.github.com>\nCo-authored-by: Woo-Yeon Lee <wooyeonlee0@gmail.com>\nCo-authored-by: Matt Wong <156021403+mawong-amd@users.noreply.github.com>\nCo-authored-by: aws-patlange <90803007+aws-patlange@users.noreply.github.com>\nCo-authored-by: Stephanie Wang <swang@cs.berkeley.edu>\nCo-authored-by: Stephanie <swang@anyscale.com>\nCo-authored-by: Luka Govedič <ProExpertProg@users.noreply.github.com>\nCo-authored-by: Chih-Chieh-Yang <7364402+cyang49@users.noreply.github.com>\nCo-authored-by: Lucas Wilkinson <lwilkinson@neuralmagic.com>\nCo-authored-by: sasha0552 <admin@sasha0552.org>\nCo-authored-by: Chip Kerchner <49959681+ChipKerchner@users.noreply.github.com>\nCo-authored-by: Abhinav Goyal <abhinav.goyal@flipkart.com>\nCo-authored-by: xwjiang2010 <87673679+xwjiang2010@users.noreply.github.com>\nCo-authored-by: Divakar Verma <137818590+divakar-amd@users.noreply.github.com>\nCo-authored-by: Ilya Lavrenov <ilya.lavrenov@intel.com>\nCo-authored-by: Robert Shaw <rshaw@neuralmagic>\nCo-authored-by: wangding zeng <155410488+zwd003@users.noreply.github.com>\nCo-authored-by: Lily Liu <lilyliupku@gmail.com>\nCo-authored-by: LiuXiaoxuanPKU <llilyliupku@gmail.com>, bong-furiosa <bongwon.jang@furiosa.ai>\nCo-authored-by: mcalman <68564154+mcalman@users.noreply.github.com>\nCo-authored-by: William Lin <SolitaryThinker@users.noreply.github.com>\nCo-authored-by: Cyrus Leung <cyrus.tl.leung@gmail.com>\nCo-authored-by: llmpros <10524065+llmpros@users.noreply.github.com>\nCo-authored-by: sang <sangcho@anyscale.com>\nCo-authored-by: Avshalom Manevich <12231371+avshalomman@users.noreply.github.com>\nCo-authored-by: James Whedbee <jamesw@telnyx.com>\nCo-authored-by: Joshua Rosenkranz <jmrosenk@us.ibm.com>\nCo-authored-by: danieljannai21 <100521221+danieljannai21@users.noreply.github.com> xjpang pushed a commit\n        to xjpang/vllm\n      that referenced\n      this pull request Jul 8, 2024 [Core] Optimize SequenceStatus.is_finished by switching to IntEnum ( v… … 0fd7504 …llm-project#5974 ) xjpang pushed a commit\n        to xjpang/vllm\n      that referenced\n      this pull request Jul 24, 2024 [Core] Optimize SequenceStatus.is_finished by switching to IntEnum ( v… … faa80a2 …llm-project#5974 ) Alvant pushed a commit\n        to compressa-ai/vllm\n      that referenced\n      this pull request Oct 26, 2024 [Core] Optimize SequenceStatus.is_finished by switching to IntEnum ( v… … c349e81 …llm-project#5974 )\n\nSigned-off-by: Alvant <alvasian@yandex.ru> simon-mo deleted the sequence_status_tweak branch October 28, 2024 16:51 Sign up for free to join this conversation on GitHub .\n    Already have an account? Sign in to comment",
  "timeline_extracted_at": "2025-09-07 17:48:43",
  "has_lm_eval": true,
  "has_performance": true,
  "has_serving": true,
  "has_general_test": true,
  "test_details": "LM_EVAL: LM-Eval | PERF: itl, benchmark serving, Optimization | SERVING: serving, serving, API server | TEST: test, test, test",
  "analysis_extracted_at": "2025-09-07 17:48:43",
  "models": [
    "meta-llama/Llama-3.1-8B-Instruct",
    "Qwen/Qwen2.5-7B-Instruct"
  ],
  "lm_eval_commands": [
    "lm_eval --model vllm --model_args pretrained=meta-llama/Llama-3.1-8B-Instruct,dtype=float16 --tasks hellaswag,arc_challenge --batch_size auto --limit 100",
    "lm_eval --model vllm --model_args pretrained=Qwen/Qwen2.5-7B-Instruct,dtype=float16 --tasks hellaswag,arc_challenge --batch_size auto --limit 100"
  ],
  "perf_command": "python benchmarks/benchmark_serving.py --model meta-llama/Llama-3.1-8B-Instruct --dtype float16 --num-prompts 300 --seed 0",
  "commit_subject": "[Core] Optimize `SequenceStatus.is_finished` by switching to IntEnum (#5974)",
  "commit_message": "[Core] Optimize `SequenceStatus.is_finished` by switching to IntEnum (#5974)",
  "commit_date": "2024-06-29T12:47:53Z",
  "files_changed": [
    "vllm/sequence.py"
  ],
  "functions_changed": [],
  "stats": {
    "num_test_files": 0,
    "num_non_test_files": 1,
    "only_test_files": 0,
    "only_non_test_files": 1,
    "num_files": 1,
    "num_hunks": 1,
    "num_edited_lines": 25,
    "num_non_test_edited_lines": 25,
    "commit_year": 2024
  },
  "diff_text": "diff --git a/vllm/sequence.py b/vllm/sequence.py\nindex 13746cef2..22cb26dc0 100644\n--- a/vllm/sequence.py\n+++ b/vllm/sequence.py\n@@ -39,24 +39,21 @@ PromptLogprobs = List[Optional[Dict[int, Logprob]]]\n SampleLogprobs = List[Dict[int, Logprob]]\n \n \n-class SequenceStatus(enum.Enum):\n+class SequenceStatus(enum.IntEnum):\n     \"\"\"Status of a sequence.\"\"\"\n-    WAITING = enum.auto()\n-    RUNNING = enum.auto()\n-    SWAPPED = enum.auto()\n-    FINISHED_STOPPED = enum.auto()\n-    FINISHED_LENGTH_CAPPED = enum.auto()\n-    FINISHED_ABORTED = enum.auto()\n-    FINISHED_IGNORED = enum.auto()\n+    WAITING = 0\n+    RUNNING = 1\n+    SWAPPED = 2\n+    # Note: anything after SWAPPED (2) will be considered\n+    # as a finished status.\n+    FINISHED_STOPPED = 3\n+    FINISHED_LENGTH_CAPPED = 4\n+    FINISHED_ABORTED = 5\n+    FINISHED_IGNORED = 6\n \n     @staticmethod\n     def is_finished(status: \"SequenceStatus\") -> bool:\n-        return status in [\n-            SequenceStatus.FINISHED_STOPPED,\n-            SequenceStatus.FINISHED_LENGTH_CAPPED,\n-            SequenceStatus.FINISHED_ABORTED,\n-            SequenceStatus.FINISHED_IGNORED,\n-        ]\n+        return status > SequenceStatus.SWAPPED\n \n     @staticmethod\n     def get_finished_reason(status: \"SequenceStatus\") -> Union[str, None]:",
  "apis": [
    "vllm.SequenceStatus",
    "vllm.SequenceStatus.is_finished"
  ],
  "affected_paths": [
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/sequence.py",
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/engine/llm_engine.py",
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/v1/engine/llm_engine.py",
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/worker/worker.py"
  ],
  "repo_path": "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm",
  "llm_reason": "The patch modifies a non-test source file (vllm/sequence.py) by switching from enum.Enum to enum.IntEnum and refactoring the is_finished function. Instead of checking membership in a list, it now performs a simple integer comparison, which is more efficient. Although the change might seem minor, it directly affects the performance of a frequently called utility function in the core API. This qualifies as a performance optimization (even though it's a micro-optimization) and is not merely a refactor or a documentation fix.",
  "llm_api_reason": "The commit changes the SequenceStatus enum in vllm/sequence.py by switching from enum.Enum to enum.IntEnum and replaces the is_finished method’s membership check with a simple numerical comparison (i.e. status > SWAPPED). This optimization leverages integer ordering, making it more efficient."
}