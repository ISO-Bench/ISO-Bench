{
  "commit_hash": "22d33baca2c0c639cfd45c48e99803e56c3efa74",
  "pr_url": "https://github.com/vllm-project/vllm/pull/15150",
  "pr_date": "2025-03-19",
  "timeline_text": "Copy link Member njhill commented Mar 19, 2025 â€¢ edited by github-actions bot Loading Uh oh! There was an error while loading. Please reload this page . Avoid the merging overhead in most common case. Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . All reactions [Misc][Perf] merge_async_iterators fast-path for single-prompt requests â€¦ c1fe348 Avoid the merging overhead in most common case.\n\nSigned-off-by: Nick Hill <nhill@redhat.com> Copy link github-actions bot commented Mar 19, 2025 ðŸ‘‹ Hi! Thank you for contributing to the vLLM project. ðŸ’¬ Join our developer Slack at https://slack.vllm.ai to discuss your PR in #pr-reviews, coordinate on features in #feat- channels, or join special interest groups in #sig- channels. Just a reminder: PRs would not trigger full CI run by default. Instead, it would only run fastcheck CI which starts running only a small and essential subset of CI tests to quickly catch errors. You can run other CI tests on top of those by going to your fastcheck build on Buildkite UI (linked in the PR checks section) and unblock them. If you do not have permission to unblock, ping simon-mo or khluu to add you in our Buildkite org. Once the PR is approved and ready to go, your PR reviewer(s) can run CI to test the changes comprehensively before merging. To run CI, PR reviewers can either: Add ready label to the PR or enable auto-merge. ðŸš€ All reactions Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . njhill changed the title [Misc][Perf] merge_async_iterators fast-path for single-prompt requests [FrontEnd][Perf] merge_async_iterators fast-path for single-prompt requests Mar 19, 2025 robertgshaw2-redhat approved these changes Mar 19, 2025 View reviewed changes robertgshaw2-redhat enabled auto-merge (squash) March 19, 2025 18:39 github-actions bot added\n  the ready ONLY add when PR is ready to merge/full CI is needed label Mar 19, 2025 Hide details View details robertgshaw2-redhat merged commit 22d33ba into vllm-project : main Mar 19, 2025 43 checks passed Uh oh! There was an error while loading. Please reload this page . njhill deleted the single-generator branch March 19, 2025 22:41 lulmer pushed a commit\n        to lulmer/vllm\n      that referenced\n      this pull request Apr 7, 2025 [FrontEnd][Perf] merge_async_iterators fast-path for single-prompt â€¦ â€¦ bed8d39 â€¦requests ( vllm-project#15150 )\n\nSigned-off-by: Nick Hill <nhill@redhat.com>\nSigned-off-by: Louis Ulmer <ulmerlouis@gmail.com> ckhordiasma mentioned this pull request Apr 17, 2025 [do not merge] pr test for nm changes into 2.20 red-hat-data-services/vllm#107 Closed shreyankg pushed a commit\n        to shreyankg/vllm\n      that referenced\n      this pull request May 3, 2025 [FrontEnd][Perf] merge_async_iterators fast-path for single-prompt â€¦ â€¦ 3f204af â€¦requests ( vllm-project#15150 )\n\nSigned-off-by: Nick Hill <nhill@redhat.com> RichardoMrMu pushed a commit\n        to RichardoMrMu/vllm\n      that referenced\n      this pull request May 12, 2025 [FrontEnd][Perf] merge_async_iterators fast-path for single-prompt â€¦ â€¦ f205d3b â€¦requests ( vllm-project#15150 )\n\nSigned-off-by: Nick Hill <nhill@redhat.com>\nSigned-off-by: Mu Huai <tianbowen.tbw@antgroup.com> Sign up for free to join this conversation on GitHub .\n    Already have an account? Sign in to comment",
  "timeline_extracted_at": "2025-09-07 17:51:45",
  "has_lm_eval": false,
  "has_performance": false,
  "has_serving": true,
  "has_general_test": true,
  "test_details": "SERVING: FrontEnd, FrontEnd, FrontEnd | TEST: test, test, CI",
  "analysis_extracted_at": "2025-09-07 17:51:45",
  "models": [
    "N/A"
  ],
  "lm_eval_commands": null,
  "perf_command": null,
  "commit_subject": "[FrontEnd][Perf] `merge_async_iterators` fast-path for single-prompt requests (#15150)",
  "commit_message": "[FrontEnd][Perf] `merge_async_iterators` fast-path for single-prompt requests (#15150)\n\nSigned-off-by: Nick Hill <nhill@redhat.com>",
  "commit_date": "2025-03-19T21:04:41Z",
  "files_changed": [
    "vllm/utils.py"
  ],
  "functions_changed": [],
  "stats": {
    "num_test_files": 0,
    "num_non_test_files": 1,
    "only_test_files": 0,
    "only_non_test_files": 1,
    "num_files": 1,
    "num_hunks": 1,
    "num_edited_lines": 5,
    "num_non_test_edited_lines": 5,
    "commit_year": 2025
  },
  "diff_text": "diff --git a/vllm/utils.py b/vllm/utils.py\nindex 79787303a..9bc081890 100644\n--- a/vllm/utils.py\n+++ b/vllm/utils.py\n@@ -411,6 +411,11 @@ async def merge_async_iterators(\n     When it yields, it yields a tuple (i, item) where i is the index of the\n     iterator that yields the item.\n     \"\"\"\n+    if len(iterators) == 1:\n+        # Fast-path single iterator case.\n+        async for item in iterators[0]:\n+            yield 0, item\n+        return\n \n     loop = asyncio.get_running_loop()",
  "apis": [
    "vllm.utils.merge_async_iterators"
  ],
  "affected_paths": [
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/entrypoints/api_server.py",
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/entrypoints/openai/api_server.py",
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/entrypoints/openai/serving_completion.py",
    "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm/vllm/engine/async_llm_engine.py"
  ],
  "repo_path": "/Users/fortuna/buckets/gso_bucket/analysis/repos/vllm",
  "llm_reason": "The commit adds a fast-path for the case where there is only one iterator in merge_async_iterators, which is a non-trivial change in the source code (vllm/utils.py) that directly optimizes the performance for single-prompt requests. This change improves efficiency by reducing overhead in that scenario, affecting performance on a CPU and being testable without specialized hardware. Thus, it meets the conditions for a performance/optimization related commit.",
  "llm_api_reason": "The commit adds a fast-path in the merge_async_iterators helper that checks for a single iterator and yields its items directly, bypassing the normal merging loop. This performance optimization affects any public or high-level code that relies on merge_async_iterators for combining asynchronous generators (for example, in streaming responses in the API endpoints)."
}