diff --git a/vllm/v1/core/block_pool.py b/vllm/v1/core/block_pool.py
index f7cebb1..786b946 100644
--- a/vllm/v1/core/block_pool.py
+++ b/vllm/v1/core/block_pool.py
@@ -166,15 +166,13 @@ class BlockPool:
         enable_caching = self.enable_caching
 
         ret: list[KVCacheBlock] = [None] * num_blocks  # type: ignore
-        idx = 0
-        while idx < num_blocks:
+        for idx in range(num_blocks):
             curr_block = popleft()
             assert curr_block.ref_cnt == 0
             if enable_caching:
                 maybe_evict(curr_block)
             incr_ref(curr_block)
             ret[idx] = curr_block
-            idx += 1
 
         return ret
 
@@ -230,7 +228,8 @@ class BlockPool:
         decr_ref = KVCacheBlock.decr_ref
         for block in ordered_blocks:
             decr_ref(block)
-            if block.ref_cnt == 0 and block is not null_block:
+            new_ref = block.ref_cnt
+            if new_ref == 0 and block is not null_block:
                 append_free(block)
 
     def reset_prefix_cache(self) -> bool:
