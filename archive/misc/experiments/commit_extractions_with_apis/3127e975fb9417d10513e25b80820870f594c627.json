{
  "commit_hash": "3127e975fb9417d10513e25b80820870f594c627",
  "parent_hash": "4001ea126692d9c4e6872936a791a1999c826156",
  "message": "[CI/Build] Make pre-commit faster (#12212)\n\nSigned-off-by: DarkLight1337 <tlleungac@connect.ust.hk>",
  "author": "Cyrus Leung <tlleungac@connect.ust.hk>",
  "date": "2025-01-20 17:36:24 +0800",
  "files_changed": [
    {
      "file_path": ".github/workflows/pre-commit.yml",
      "old_content": "name: pre-commit\n\non:\n  pull_request:\n  push:\n    branches: [main]\n\njobs:\n  pre-commit:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2\n    - uses: actions/setup-python@0b93645e9fea7318ecaed2b359559ac225c90a2b # v5.3.0\n      with:\n        python-version: \"3.12\"\n    - run: echo \"::add-matcher::.github/workflows/matchers/actionlint.json\"\n    - uses: pre-commit/action@2c7b3805fd2a0fd8c1884dcaebf91fc102a13ecd # v3.0.1\n",
      "diff": "diff --git a/.github/workflows/pre-commit.yml b/.github/workflows/pre-commit.yml\nindex 8c72a709c..bf9460151 100644\n--- a/.github/workflows/pre-commit.yml\n+++ b/.github/workflows/pre-commit.yml\n@@ -15,3 +15,5 @@ jobs:\n         python-version: \"3.12\"\n     - run: echo \"::add-matcher::.github/workflows/matchers/actionlint.json\"\n     - uses: pre-commit/action@2c7b3805fd2a0fd8c1884dcaebf91fc102a13ecd # v3.0.1\n+      with:\n+        extra_args: --hook-stage manual",
      "change_type": "modified",
      "lines_added": 3,
      "lines_removed": 1
    },
    {
      "file_path": ".pre-commit-config.yaml",
      "old_content": "repos:\n- repo: https://github.com/google/yapf\n  rev: v0.32.0\n  hooks:\n  - id: yapf\n    args: [--in-place, --verbose]\n    additional_dependencies: [toml] # TODO: Remove when yapf is upgraded\n- repo: https://github.com/astral-sh/ruff-pre-commit\n  rev: v0.6.5\n  hooks:\n  - id: ruff\n    args: [--output-format, github]\n- repo: https://github.com/codespell-project/codespell\n  rev: v2.3.0\n  hooks:\n  - id: codespell\n    exclude: 'benchmarks/sonnet.txt|(build|tests/(lora/data|models/fixtures|prompts))/.*'\n- repo: https://github.com/PyCQA/isort\n  rev: 5.13.2\n  hooks:\n  - id: isort\n- repo: https://github.com/pre-commit/mirrors-clang-format\n  rev: v18.1.5\n  hooks:\n  - id: clang-format\n    exclude: 'csrc/(moe/topk_softmax_kernels.cu|quantization/gguf/(ggml-common.h|dequantize.cuh|vecdotq.cuh|mmq.cuh|mmvq.cuh))'\n    types_or: [c++, cuda]\n    args: [--style=file, --verbose]\n- repo: https://github.com/jackdewinter/pymarkdown\n  rev: v0.9.27\n  hooks:\n  - id: pymarkdown\n    files: docs/.*\n- repo: local\n  hooks:\n  - id: mypy-3.9 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n    name: Run mypy for Python 3.9\n    entry: tools/mypy.sh 1 \"3.9\"\n    language: python\n    types: [python]\n    additional_dependencies: &mypy_deps [mypy==1.11.1, types-setuptools, types-PyYAML, types-requests]\n  - id: mypy-3.10 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n    name: Run mypy for Python 3.10\n    entry: tools/mypy.sh 1 \"3.10\"\n    language: python\n    types: [python]\n    additional_dependencies: *mypy_deps\n  - id: mypy-3.11 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n    name: Run mypy for Python 3.11\n    entry: tools/mypy.sh 1 \"3.11\"\n    language: python\n    types: [python]\n    additional_dependencies: *mypy_deps\n  - id: mypy-3.12 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n    name: Run mypy for Python 3.12\n    entry: tools/mypy.sh 1 \"3.12\"\n    language: python\n    types: [python]\n    additional_dependencies: *mypy_deps\n  - id: shellcheck\n    name: Lint shell scripts\n    entry: tools/shellcheck.sh\n    language: script\n    types: [shell]\n  - id: png-lint\n    name: Lint PNG exports from excalidraw\n    entry: tools/png-lint.sh\n    language: script\n    types: [png]\n- repo: https://github.com/rhysd/actionlint\n  rev: v1.7.6\n  hooks:\n  - id: actionlint\n",
      "diff": "diff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex 8ea0f3788..47eddb345 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -1,3 +1,6 @@\n+default_stages:\n+  - pre-commit # Run locally\n+  - manual # Run in CI\n repos:\n - repo: https://github.com/google/yapf\n   rev: v0.32.0\n@@ -33,30 +36,41 @@ repos:\n     files: docs/.*\n - repo: local\n   hooks:\n+  - id: mypy-local\n+    name: Run mypy for local Python installation\n+    entry: tools/mypy.sh\n+    language: python\n+    types: [python]\n+    additional_dependencies: &mypy_deps [mypy==1.11.1, types-setuptools, types-PyYAML, types-requests]\n+    stages: [pre-commit] # Don't run in CI\n   - id: mypy-3.9 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n     name: Run mypy for Python 3.9\n     entry: tools/mypy.sh 1 \"3.9\"\n     language: python\n     types: [python]\n-    additional_dependencies: &mypy_deps [mypy==1.11.1, types-setuptools, types-PyYAML, types-requests]\n+    additional_dependencies: *mypy_deps\n+    stages: [manual] # Only run in CI\n   - id: mypy-3.10 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n     name: Run mypy for Python 3.10\n     entry: tools/mypy.sh 1 \"3.10\"\n     language: python\n     types: [python]\n     additional_dependencies: *mypy_deps\n+    stages: [manual] # Only run in CI\n   - id: mypy-3.11 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n     name: Run mypy for Python 3.11\n     entry: tools/mypy.sh 1 \"3.11\"\n     language: python\n     types: [python]\n     additional_dependencies: *mypy_deps\n+    stages: [manual] # Only run in CI\n   - id: mypy-3.12 # TODO: Use https://github.com/pre-commit/mirrors-mypy when mypy setup is less awkward\n     name: Run mypy for Python 3.12\n     entry: tools/mypy.sh 1 \"3.12\"\n     language: python\n     types: [python]\n     additional_dependencies: *mypy_deps\n+    stages: [manual] # Only run in CI\n   - id: shellcheck\n     name: Lint shell scripts\n     entry: tools/shellcheck.sh",
      "change_type": "modified",
      "lines_added": 16,
      "lines_removed": 2
    }
  ],
  "affected_apis": [],
  "summary": {
    "total_files": 2,
    "files_added": 0,
    "files_deleted": 0,
    "files_modified": 2
  },
  "csv_metadata": {
    "category": "miscellaneous",
    "json_has_tests": "FALSE",
    "json_has_benchmarks": "FALSE",
    "is_test_actually_there": "NO",
    "is_benchmark_actually_there": "",
    "sample_clues": ".pre-commit-config, none, pre-commit"
  }
}