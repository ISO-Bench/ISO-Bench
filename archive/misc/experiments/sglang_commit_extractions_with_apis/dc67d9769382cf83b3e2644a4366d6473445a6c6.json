{
  "commit_hash": "dc67d9769382cf83b3e2644a4366d6473445a6c6",
  "pr_url": "https://github.com/sgl-project/sglang/pull/1319",
  "pr_date": "2024-09-03",
  "timeline_text": "Copy link Member zhyncs commented Sep 3, 2024 Motivation Modifications Checklist Format your code according to the Contributor Guide . Add unit tests as outlined in the Contributor Guide . Update documentation as needed, including docstrings or example tutorials. Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . All reactions zhyncs requested review from Ying1123 , merrymercy , ispobock and hnyls2002 September 3, 2024 17:41 misc: speedup load safetensors \u2026 04c5972 Co-authored-by: ispobock <ISPObaoke@163.com> zhyncs force-pushed the speedup branch\n    from a7a68ce to 04c5972 Compare September 3, 2024 18:11 ispobock approved these changes Sep 3, 2024 View reviewed changes Copy link Member Author zhyncs commented Sep 3, 2024 python3 benchmark/gsm8k/bench_sglang.py\n\nLatency: 92.746\nInvalid: 0.000\nAccuracy: 0.935\n\npython3 -m sglang.bench_serving --backend sglang --num-prompts 5000\n\n============ Serving Benchmark Result ============\nBackend:                                 sglang\nTraffic request rate:                    inf\nSuccessful requests:                     5000\nBenchmark duration (s):                  346.41\nTotal input tokens:                      1224620\nTotal generated tokens:                  1061203\nTotal generated tokens (retokenized):    1055493\nRequest throughput (req/s):              14.43\nInput token throughput (tok/s):          3535.22\nOutput token throughput (tok/s):         3063.47\n----------------End-to-End Latency----------------\nMean E2E Latency (ms):                   145289.76\nMedian E2E Latency (ms):                 143439.03\n---------------Time to First Token----------------\nMean TTFT (ms):                          60141.13\nMedian TTFT (ms):                        55335.66\nP99 TTFT (ms):                           131151.83\n-----Time per Output Token (excl. 1st token)------\nMean TPOT (ms):                          742.79\nMedian TPOT (ms):                        549.99\nP99 TPOT (ms):                           4744.62\n---------------Inter-token Latency----------------\nMean ITL (ms):                           424.83\nMedian ITL (ms):                         237.24\nP99 ITL (ms):                            1699.88\n================================================= All reactions Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . Hide details View details zhyncs merged commit dc67d97 into main Sep 3, 2024 8 of 9 checks passed Uh oh! There was an error while loading. Please reload this page . zhyncs deleted the speedup branch September 3, 2024 18:29 Copy link Member Author zhyncs commented Sep 3, 2024 ref https://github.com/sgl-project/sglang/actions/runs/10688838706/job/29629552751 All reactions Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . timethink pushed a commit\n        to timethink/sglang\n      that referenced\n      this pull request Mar 9, 2025 misc: speedup load safetensors ( sgl-project#1319 ) \u2026 0e2ddcd Co-authored-by: ispobock <ISPObaoke@163.com> Sign up for free to join this conversation on GitHub .\n    Already have an account? Sign in to comment",
  "timeline_extracted_at": "2025-09-11 19:00:39",
  "has_lm_eval": true,
  "has_performance": true,
  "has_serving": true,
  "has_general_test": true,
  "test_details": "LM_EVAL | PERF | SERVING | TEST",
  "analysis_extracted_at": null,
  "models": [
    "N/A"
  ],
  "lm_eval_commands": null,
  "perf_command": "python3 -m sglang.bench_serving --backend sglang --num-prompts 5000",
  "commit_subject": "misc: speedup load safetensors (#1319)",
  "commit_message": "misc: speedup load safetensors (#1319)\n\nCo-authored-by: ispobock <ISPObaoke@163.com>",
  "commit_date": "2024-09-04T04:29:53+10:00",
  "files_changed": [
    "python/sglang/srt/model_executor/model_runner.py"
  ],
  "functions_changed": [],
  "stats": {
    "commit_year": 2024,
    "num_edited_lines": 1,
    "num_files": 1,
    "num_hunks": 1,
    "num_non_test_edited_lines": 1,
    "num_non_test_files": 1,
    "num_test_files": 0,
    "only_non_test_files": 1,
    "only_test_files": 0
  },
  "diff_text": "diff --git a/python/sglang/srt/model_executor/model_runner.py b/python/sglang/srt/model_executor/model_runner.py\nindex 09b3c7127..3d3e0cde9 100644\n--- a/python/sglang/srt/model_executor/model_runner.py\n+++ b/python/sglang/srt/model_executor/model_runner.py\n@@ -162,6 +162,7 @@ class ModelRunner:\n         return min_per_gpu_memory\n \n     def load_model(self):\n+        torch.set_num_threads(1)\n         logger.info(\n             f\"Load weight begin. avail mem={get_available_gpu_memory(self.gpu_id):.2f} GB\"\n         )",
  "apis": [
    "ModelRunner.load_model"
  ],
  "affected_paths": [
    "/path/to/repos/sglang/python/sglang/srt/model_executor/model_runner.py",
    "/path/to/repos/sglang/python/sglang/api.py",
    "/path/to/repos/sglang/python/sglang/srt/model_loader/loader.py"
  ],
  "repo_path": "/path/to/repos/sglang",
  "llm_reason": "The commit modifies a production file (model_runner.py) by adding \"torch.set_num_threads(1)\" in the load_model function, which is likely intended to control CPU threading during model loading. The commit message \"misc: speedup load safetensors\" suggests a performance optimization intended to reduce overhead during loading. The change is made in non-test code, is performance-related, and is testable on a CPU without specific hardware prerequisites. Therefore, it satisfies the conditions for being a performance/optimization change.",
  "llm_api_reason": "The commit adds a call to torch.set_num_threads(1) at the start of the load_model() method in the ModelRunner class. This adjustment is likely intended to speed up loading when using safetensors, which may indirectly affect performance. Hence, the load_model API in ModelRunner is affected by this change."
}