{
  "commit_hash": "b170930534acbb9c1619a3c83670a839ceee763a",
  "pr_url": "https://github.com/sgl-project/sglang/pull/1697",
  "pr_date": "2024-10-17",
  "timeline_text": "Copy link Contributor wxsms commented Oct 17, 2024 remove useless range slice Motivation the slice feels useless. just access with index looks the same and better peformance. I cant't find any unittests with this file though. not sure. Modifications _split_node in radix_cache.py Checklist Format your code according to the Contributor Guide . Add unit tests as outlined in the Contributor Guide . Update documentation as needed, including docstrings or example tutorials. Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . All reactions feat: radix tree code optimize \u2026 d1d9bb5 remove useless range slice merrymercy approved these changes Oct 17, 2024 View reviewed changes merrymercy enabled auto-merge (squash) October 17, 2024 14:49 Copy link Contributor merrymercy commented Oct 17, 2024 Thanks! A good catch! All reactions Sorry, something went wrong. Uh oh! There was an error while loading. Please reload this page . merrymercy disabled auto-merge October 17, 2024 15:01 Hide details View details merrymercy merged commit b170930 into sgl-project : main Oct 17, 2024 5 of 10 checks passed Uh oh! There was an error while loading. Please reload this page . timethink pushed a commit\n        to timethink/sglang\n      that referenced\n      this pull request Mar 9, 2025 feat: radix tree code optimize ( sgl-project#1697 ) b0cdae2 Sign up for free to join this conversation on GitHub .\n    Already have an account? Sign in to comment",
  "timeline_extracted_at": "2025-09-11 19:00:22",
  "has_lm_eval": false,
  "has_performance": false,
  "has_serving": false,
  "has_general_test": false,
  "test_details": "NONE",
  "analysis_extracted_at": null,
  "models": [
    "N/A"
  ],
  "lm_eval_commands": null,
  "perf_command": null,
  "commit_subject": "feat: radix tree code optimize (#1697)",
  "commit_message": "feat: radix tree code optimize (#1697)",
  "commit_date": "2024-10-17T08:01:27-07:00",
  "files_changed": [
    "python/sglang/srt/mem_cache/radix_cache.py"
  ],
  "functions_changed": [],
  "stats": {
    "commit_year": 2024,
    "num_edited_lines": 4,
    "num_files": 1,
    "num_hunks": 2,
    "num_non_test_edited_lines": 4,
    "num_non_test_files": 1,
    "num_test_files": 0,
    "only_non_test_files": 1,
    "only_test_files": 0
  },
  "diff_text": "diff --git a/python/sglang/srt/mem_cache/radix_cache.py b/python/sglang/srt/mem_cache/radix_cache.py\nindex 68bcb5b0b..6e2dee3c2 100644\n--- a/python/sglang/srt/mem_cache/radix_cache.py\n+++ b/python/sglang/srt/mem_cache/radix_cache.py\n@@ -245,7 +245,7 @@ class RadixCache(BasePrefixCache):\n     def _split_node(self, key, child: TreeNode, split_len: int):\n         # new_node -> child\n         new_node = TreeNode()\n-        new_node.children = {key[split_len:][0]: child}\n+        new_node.children = {key[split_len]: child}\n         new_node.parent = child.parent\n         new_node.lock_ref = child.lock_ref\n         new_node.key = child.key[:split_len]\n@@ -253,7 +253,7 @@ class RadixCache(BasePrefixCache):\n         child.parent = new_node\n         child.key = child.key[split_len:]\n         child.value = child.value[split_len:]\n-        new_node.parent.children[key[:split_len][0]] = new_node\n+        new_node.parent.children[key[0]] = new_node\n         return new_node\n \n     def _insert_helper(self, node: TreeNode, key: List, value):",
  "apis": [
    "sglang.srt.mem_cache.radix_cache.RadixCache",
    "sglang.srt.mem_cache.hiradix_cache.HiRadixCache"
  ],
  "affected_paths": [
    "/path/to/repos/sglang/python/sglang/srt/mem_cache/radix_cache.py",
    "/path/to/repos/sglang/python/sglang/srt/mem_cache/hiradix_cache.py",
    "/path/to/repos/sglang/python/sglang/api.py"
  ],
  "repo_path": "/path/to/repos/sglang",
  "llm_reason": "The commit modifies a non-test source file (the radix_cache.py file) by changing how keys are indexed in a radix tree implementation. Instead of slicing the key and then taking the first element, it directly accesses the element (e.g., changing key[split_len:][0] to key[split_len]). This subtle change eliminates the creation of an intermediate slice, which can result in a performance improvement. The commit is not just a bug fix or mere refactoring\u2014it optimizes an operation that is likely used in performance-critical parts of a caching mechanism. Though the message mentions \"optimize\", the nature of the change supports that interpretation as a performance optimization rather than a renaming of a module or similar. It affects the CPU performance and is testable without specific hardware weather. Overall, the changes meet the criteria for a performance/optimization-related commit.",
  "llm_api_reason": "The commit modifies the radix tree\u2019s node splitting logic in the _split_node method of the RadixCache class. Instead of slicing the key and then taking the first element ([key[split_len:][0]]), it now directly uses key[split_len] and similarly for updating the parent\u2019s children mapping. This optimization affects the public behavior of RadixCache (and, by inheritance, HiRadixCache), since methods like insert and match_prefix depend on the correct splitting of keys in the radix tree for proper cache operations."
}