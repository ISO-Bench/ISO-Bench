{
  "instance": {
    "commit_hash": "dc1881326f61734a4160620b6e12a5542b756066",
    "commit_subject": "Fix perf regression on small batch sizes (#3008)",
    "repo": "sglang",
    "pr_url": "https://github.com/sgl-project/sglang/pull/3008",
    "files_changed": [
      "python/sglang/srt/layers/radix_attention.py",
      "python/sglang/srt/mem_cache/memory_pool.py"
    ]
  },
  "result": {
    "status": "baseline_failed",
    "commit_hash": "dc1881326f61734a4160620b6e12a5542b756066",
    "baseline_ms": null,
    "patched_ms": null,
    "speedup": null,
    "improvement": false,
    "baseline_output": null,
    "patched_output": null,
    "error_message": "Baseline test failed to produce JSON output",
    "stdout": "",
    "stderr": "Traceback (most recent call last):\n  File \"/tmp/omniperf_test_kwuhzu7z.py\", line 115, in setup\n    from sglang.srt.mem_cache.memory_pool import MHATokenToKVPool\n  File \"/tmp/omniperf_worktree_f1c_dkwg/worktree/python/sglang/srt/mem_cache/memory_pool.py\", line 36, in <module>\n    from sglang.srt.layers.radix_attention import RadixAttention\n  File \"/tmp/omniperf_worktree_f1c_dkwg/worktree/python/sglang/srt/layers/radix_attention.py\", line 18, in <module>\n    from sglang.srt.model_executor.forward_batch_info import ForwardBatch\n  File \"/tmp/omniperf_worktree_f1c_dkwg/worktree/python/sglang/srt/model_executor/forward_batch_info.py\", line 41, in <module>\n    from sglang.srt.utils import maybe_torch_compile\n  File \"/tmp/omniperf_worktree_f1c_dkwg/worktree/python/sglang/srt/utils.py\", line 56, in <module>\n    from triton.runtime.cache import (\nImportError: cannot import name 'default_cache_dir' from 'triton.runtime.cache' (/root/OmniPerf-Bench/bench-env/lib/python3.12/site-packages/triton/runtime/cache.py)\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/tmp/omniperf_test_kwuhzu7z.py\", line 389, in <module>\n    run_test(args.eqcheck, args.reference, args.prefix)\n  File \"/tmp/omniperf_test_kwuhzu7z.py\", line 320, in run_test\n    data = setup()\n           ^^^^^^^\n  File \"/tmp/omniperf_test_kwuhzu7z.py\", line 158, in setup\n    pool = MockPool()\n           ^^^^^^^^^^\n  File \"/tmp/omniperf_test_kwuhzu7z.py\", line 137, in __init__\n    self.k_buffer = [torch.zeros(total_tokens, num_heads, head_dim, device=device, dtype=dtype) \n                                 ^^^^^^^^^^^^\nNameError: cannot access free variable 'total_tokens' where it is not associated with a value in enclosing scope\n",
    "duration_s": 5.081815242767334,
    "patch_path": "/root/OmniPerf-Bench/perf-agents-bench/state/runs/sglang/claude_code/default/2025-12-23_06-28-44/sglang_066_dc188132/model_patch.diff",
    "patch_stats": null
  }
}