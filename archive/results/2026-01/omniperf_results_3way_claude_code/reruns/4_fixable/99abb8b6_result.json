{
  "commit_short": "99abb8b6",
  "commit_full": "99abb8b650c66664cdc84d815b7f306f33bd9881",
  "parent_hash": "3a1e6481586ed7f079275b5d5072a6e246af691e",
  "task_id": "vllm_core-0051",
  "model": "meta-llama/Llama-3.1-8B-Instruct",
  "benchmark_type": "latency",
  "description": "Optimize Rejection Sampler with Triton Kernels",
  "issue": "Missing space in command",
  "fix": "Fix: '[ngram]' --ngram (add space)",
  "timestamp": "2026-01-16 18:17:31",
  "baseline_command": "python benchmarks/benchmark_latency.py --model meta-llama/Llama-3.1-8B-Instruct --speculative-model [ngram] --ngram-prompt-lookup-min 5 --ngram-prompt-lookup-max 10 --num-speculative-tokens 5 --input-len 550 --output-len 150",
  "test_command": "python benchmarks/benchmark_latency.py --model meta-llama/Llama-3.1-8B-Instruct --speculative-model [ngram] --ngram-prompt-lookup-min 5 --ngram-prompt-lookup-max 10 --num-speculative-tokens 5 --input-len 550 --output-len 150",
  "is_asymmetric": false,
  "num_trials": 1,
  "baseline": {
    "status": "success",
    "metrics": {
      "latency_avg_ms": 2174.039090000345,
      "throughput_tok_s": 2635.1
    },
    "duration_s": 140.09242963790894,
    "raw_output": " tokens: 10, Number of emitted tokens: 3.\n\nProfiling iterations:  57%|\u2588\u2588\u2588\u2588\u2588\u258b    | 17/30 [00:36<00:28,  2.17s/it]INFO 01-16 18:19:20 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.28 scoring_time_ms=11.63 verification_time_ms=0.19\n\nProfiling iterations:  60%|\u2588\u2588\u2588\u2588\u2588\u2588    | 18/30 [00:39<00:26,  2.17s/it]\nProfiling iterations:  63%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e   | 19/30 [00:41<00:23,  2.18s/it]INFO 01-16 18:19:25 [metrics.py:481] Avg prompt throughput: 2635.4 tokens/s, Avg generation throughput: 536.7 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.4%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:19:25 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.500, System efficiency: 0.250, Number of speculative tokens: 5, Number of accepted tokens: 5, Number of draft tokens: 10, Number of emitted tokens: 3.\nINFO 01-16 18:19:25 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.63 scoring_time_ms=11.41 verification_time_ms=0.45\n\nProfiling iterations:  67%|\u2588\u2588\u2588\u2588\u2588\u2588\u258b   | 20/30 [00:43<00:21,  2.19s/it]\nProfiling iterations:  70%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588   | 21/30 [00:45<00:19,  2.18s/it]INFO 01-16 18:19:30 [metrics.py:481] Avg prompt throughput: 1756.5 tokens/s, Avg generation throughput: 554.1 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.4%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:19:30 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.500, System efficiency: 0.250, Number of speculative tokens: 5, Number of accepted tokens: 5, Number of draft tokens: 10, Number of emitted tokens: 3.\nINFO 01-16 18:19:30 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.30 scoring_time_ms=11.12 verification_time_ms=0.21\n\nProfiling iterations:  73%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e  | 22/30 [00:47<00:17,  2.18s/it]\nProfiling iterations:  77%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b  | 23/30 [00:50<00:15,  2.17s/it]INFO 01-16 18:19:35 [metrics.py:481] Avg prompt throughput: 1757.8 tokens/s, Avg generation throughput: 559.3 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.6%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:19:35 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.500, System efficiency: 0.250, Number of speculative tokens: 5, Number of accepted tokens: 5, Number of draft tokens: 10, Number of emitted tokens: 3.\nINFO 01-16 18:19:35 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.33 scoring_time_ms=11.15 verification_time_ms=0.19\n\nProfiling iterations:  80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  | 24/30 [00:52<00:13,  2.17s/it]\nProfiling iterations:  83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 25/30 [00:54<00:10,  2.17s/it]\nProfiling iterations:  87%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 26/30 [00:56<00:08,  2.17s/it]INFO 01-16 18:19:40 [metrics.py:481] Avg prompt throughput: 2637.3 tokens/s, Avg generation throughput: 540.3 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.3%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:19:40 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.500, System efficiency: 0.250, Number of speculative tokens: 5, Number of accepted tokens: 5, Number of draft tokens: 10, Number of emitted tokens: 3.\nINFO 01-16 18:19:40 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.29 scoring_time_ms=11.06 verification_time_ms=0.21\n\nProfiling iterations:  90%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 27/30 [00:58<00:06,  2.17s/it]\nProfiling iterations:  93%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 28/30 [01:00<00:04,  2.17s/it]INFO 01-16 18:19:45 [metrics.py:481] Avg prompt throughput: 1758.8 tokens/s, Avg generation throughput: 559.6 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.4%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:19:45 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.500, System efficiency: 0.250, Number of speculative tokens: 5, Number of accepted tokens: 5, Number of draft tokens: 10, Number of emitted tokens: 3.\nINFO 01-16 18:19:45 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.31 scoring_time_ms=11.09 verification_time_ms=0.21\n\nProfiling iterations:  97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 29/30 [01:03<00:02,  2.17s/it]\nProfiling iterations: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 30/30 [01:05<00:00,  2.17s/it]\nProfiling iterations: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 30/30 [01:05<00:00,  2.17s/it]\nAvg latency: 2.174039090000345 seconds\n10% percentile latency: 2.16461203880026 seconds\n25% percentile latency: 2.1657746500013673 seconds\n50% percentile latency: 2.168114684000102 seconds\n75% percentile latency: 2.1754512775005423 seconds\n90% percentile latency: 2.1886876833017594 seconds\n99% percentile latency: 2.2230718714207613 seconds\n[rank0]:[W116 18:19:49.499356817 ProcessGroupNCCL.cpp:1496] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())\n\nBENCHMARK_COMPLETE\n"
  },
  "human": {
    "status": "success",
    "metrics": {
      "latency_avg_ms": 2179.971499000385,
      "throughput_tok_s": 2634.0
    },
    "duration_s": 148.69666242599487,
    "raw_output": "ons:  77%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b  | 23/30 [00:50<00:15,  2.18s/it]INFO 01-16 18:22:03 [metrics.py:481] Avg prompt throughput: 1757.5 tokens/s, Avg generation throughput: 556.0 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.5%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:22:03 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.800, System efficiency: 0.667, Number of speculative tokens: 5, Number of accepted tokens: 12, Number of draft tokens: 15, Number of emitted tokens: 12.\nINFO 01-16 18:22:03 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.32 scoring_time_ms=11.14 verification_time_ms=0.19\n\nProfiling iterations:  80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  | 24/30 [00:52<00:13,  2.18s/it]\nProfiling iterations:  83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 25/30 [00:54<00:10,  2.18s/it]INFO 01-16 18:22:08 [metrics.py:481] Avg prompt throughput: 1759.3 tokens/s, Avg generation throughput: 555.0 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.6%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:22:08 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.800, System efficiency: 0.667, Number of speculative tokens: 5, Number of accepted tokens: 12, Number of draft tokens: 15, Number of emitted tokens: 12.\n\nProfiling iterations:  87%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 26/30 [00:56<00:08,  2.18s/it]INFO 01-16 18:22:08 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.29 scoring_time_ms=11.10 verification_time_ms=0.19\n\nProfiling iterations:  90%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 27/30 [00:58<00:06,  2.18s/it]\nProfiling iterations:  93%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 28/30 [01:01<00:04,  2.18s/it]INFO 01-16 18:22:13 [metrics.py:481] Avg prompt throughput: 2639.5 tokens/s, Avg generation throughput: 537.5 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.4%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:22:13 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.800, System efficiency: 0.667, Number of speculative tokens: 5, Number of accepted tokens: 12, Number of draft tokens: 15, Number of emitted tokens: 12.\nINFO 01-16 18:22:13 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.30 scoring_time_ms=11.05 verification_time_ms=0.18\n\nProfiling iterations:  97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 29/30 [01:03<00:02,  2.18s/it]\nProfiling iterations: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 30/30 [01:05<00:00,  2.18s/it]\nProfiling iterations: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 30/30 [01:05<00:00,  2.18s/it]\nAvg latency: 2.179971499000385 seconds\n10% percentile latency: 2.177658427701317 seconds\n25% percentile latency: 2.178150117248151 seconds\n50% percentile latency: 2.1797193690017593 seconds\n75% percentile latency: 2.181337725000958 seconds\n90% percentile latency: 2.1834473690996674 seconds\n99% percentile latency: 2.1843047734810535 seconds\n[rank0]:[W116 18:22:17.175714656 ProcessGroupNCCL.cpp:1496] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())\n\nBENCHMARK_COMPLETE\nUnable to find image 'anonymous/vllm-baseline:human-99abb8b650c66664cdc84d815b7f306f33bd9881' locally\nhuman-99abb8b650c66664cdc84d815b7f306f33bd9881: Pulling from anonymous/vllm-baseline\n3c645031de29: Already exists\n0d6448aff889: Already exists\n0a7674e3e8fe: Already exists\nb71b637b97c5: Already exists\n56dc85502937: Already exists\nec6d5f6c9ed9: Already exists\n47b8539d532f: Already exists\nfd9cc1ad8dee: Already exists\n83525caeeb35: Already exists\n8e79813a7b9d: Already exists\n312a542960e3: Already exists\n949691b47390: Already exists\n7cbb09265719: Already exists\nc1418d32082b: Already exists\n7b190e861cd3: Already exists\na2174ed770d5: Already exists\n4f4fb700ef54: Already exists\nb652f1805f42: Already exists\nc37de3041c01: Already exists\n0fe2e5d2db60: Already exists\ne265b8391010: Already exists\n955a4eae3855: Already exists\n477046108da7: Already exists\nec400c1e0947: Pulling fs layer\n51ca34013f86: Pulling fs layer\n13ad8e9f7492: Pulling fs layer\n8d4b3ea85338: Pulling fs layer\n2907c3729756: Pulling fs layer\n71260b7e8aae: Pulling fs layer\n2907c3729756: Waiting\n71260b7e8aae: Waiting\n8d4b3ea85338: Waiting\nec400c1e0947: Verifying Checksum\nec400c1e0947: Download complete\nec400c1e0947: Pull complete\n8d4b3ea85338: Verifying Checksum\n8d4b3ea85338: Download complete\n2907c3729756: Verifying Checksum\n2907c3729756: Download complete\n71260b7e8aae: Verifying Checksum\n71260b7e8aae: Download complete\n13ad8e9f7492: Verifying Checksum\n13ad8e9f7492: Download complete\n51ca34013f86: Verifying Checksum\n51ca34013f86: Download complete\n51ca34013f86: Pull complete\n13ad8e9f7492: Pull complete\n8d4b3ea85338: Pull complete\n2907c3729756: Pull complete\n71260b7e8aae: Pull complete\nDigest: sha256:b63a8bba5e0b42114310b1bd8d28be45e4392e819c70d822a0fe6a3b1452c5fd\nStatus: Downloaded newer image for anonymous/vllm-baseline:human-99abb8b650c66664cdc84d815b7f306f33bd9881\n"
  },
  "agent": {
    "status": "success",
    "metrics": {
      "latency_avg_ms": 2186.5847636334365,
      "throughput_tok_s": 2635.6
    },
    "duration_s": 140.4351463317871,
    "raw_output": "tive tokens: 5, Number of accepted tokens: 8, Number of draft tokens: 15, Number of emitted tokens: 4.\nINFO 01-16 18:24:09 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.30 scoring_time_ms=11.08 verification_time_ms=0.19\n\nProfiling iterations:  60%|\u2588\u2588\u2588\u2588\u2588\u2588    | 18/30 [00:39<00:26,  2.19s/it]\nProfiling iterations:  63%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e   | 19/30 [00:41<00:24,  2.19s/it]INFO 01-16 18:24:14 [metrics.py:481] Avg prompt throughput: 1757.0 tokens/s, Avg generation throughput: 553.3 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.4%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:24:14 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.533, System efficiency: 0.222, Number of speculative tokens: 5, Number of accepted tokens: 8, Number of draft tokens: 15, Number of emitted tokens: 4.\nINFO 01-16 18:24:14 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.32 scoring_time_ms=11.09 verification_time_ms=0.19\n\nProfiling iterations:  67%|\u2588\u2588\u2588\u2588\u2588\u2588\u258b   | 20/30 [00:43<00:21,  2.19s/it]\nProfiling iterations:  70%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588   | 21/30 [00:45<00:19,  2.19s/it]INFO 01-16 18:24:19 [metrics.py:481] Avg prompt throughput: 1755.8 tokens/s, Avg generation throughput: 553.9 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.5%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:24:19 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.640, System efficiency: 0.367, Number of speculative tokens: 5, Number of accepted tokens: 16, Number of draft tokens: 25, Number of emitted tokens: 11.\nINFO 01-16 18:24:19 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.32 scoring_time_ms=11.13 verification_time_ms=0.19\n\nProfiling iterations:  73%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e  | 22/30 [00:48<00:17,  2.19s/it]\nProfiling iterations:  77%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b  | 23/30 [00:50<00:15,  2.19s/it]INFO 01-16 18:24:24 [metrics.py:481] Avg prompt throughput: 1756.6 tokens/s, Avg generation throughput: 552.5 tokens/s, Running: 7 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.4%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:24:24 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.640, System efficiency: 0.367, Number of speculative tokens: 5, Number of accepted tokens: 16, Number of draft tokens: 25, Number of emitted tokens: 11.\n\nProfiling iterations:  80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  | 24/30 [00:52<00:13,  2.19s/it]INFO 01-16 18:24:24 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.28 scoring_time_ms=11.90 verification_time_ms=0.24\n\nProfiling iterations:  83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 25/30 [00:54<00:10,  2.19s/it]\nProfiling iterations:  87%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 26/30 [00:56<00:08,  2.19s/it]INFO 01-16 18:24:29 [metrics.py:481] Avg prompt throughput: 2637.6 tokens/s, Avg generation throughput: 535.1 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.4%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:24:29 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.600, System efficiency: 0.389, Number of speculative tokens: 5, Number of accepted tokens: 18, Number of draft tokens: 30, Number of emitted tokens: 14.\nINFO 01-16 18:24:29 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.30 scoring_time_ms=11.25 verification_time_ms=0.21\n\nProfiling iterations:  90%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 27/30 [00:59<00:06,  2.19s/it]\nProfiling iterations:  93%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 28/30 [01:01<00:04,  2.19s/it]INFO 01-16 18:24:34 [metrics.py:481] Avg prompt throughput: 1756.3 tokens/s, Avg generation throughput: 554.0 tokens/s, Running: 8 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 1.5%, CPU KV cache usage: 0.0%.\nINFO 01-16 18:24:34 [metrics.py:503] Speculative metrics: Draft acceptance rate: 0.600, System efficiency: 0.389, Number of speculative tokens: 5, Number of accepted tokens: 18, Number of draft tokens: 30, Number of emitted tokens: 14.\nINFO 01-16 18:24:34 [spec_decode_worker.py:1115] SpecDecodeWorker stage times: average_time_per_proposal_tok_ms=0.31 scoring_time_ms=11.15 verification_time_ms=0.20\n\nProfiling iterations:  97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 29/30 [01:03<00:02,  2.19s/it]\nProfiling iterations: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 30/30 [01:05<00:00,  2.19s/it]\nProfiling iterations: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 30/30 [01:05<00:00,  2.19s/it]\nAvg latency: 2.1865847636334363 seconds\n10% percentile latency: 2.1813670035011454 seconds\n25% percentile latency: 2.1856023475002075 seconds\n50% percentile latency: 2.1877113260015904 seconds\n75% percentile latency: 2.189251810749738 seconds\n90% percentile latency: 2.19012676820239 seconds\n99% percentile latency: 2.1929258488898995 seconds\n[rank0]:[W116 18:24:38.555969443 ProcessGroupNCCL.cpp:1496] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())\n\nBENCHMARK_COMPLETE\n"
  },
  "analysis": {
    "primary_metric": "latency_avg_ms",
    "baseline_value": 2174.039090000345,
    "human_value": 2179.971499000385,
    "agent_value": 2186.5847636334365,
    "human_improvement_pct": -0.27,
    "agent_improvement_pct": -0.58
  }
}